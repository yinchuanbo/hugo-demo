---
title: "æƒ³å¼„æ‡‚Babelï¼Ÿä½ å¿…é¡»å¾—å…ˆå¼„æ¸…æ¥šè¿™å‡ ä¸ªåŒ…"
date: 2023-03-30T07:41:54+08:00
---

![æƒ³å¼„æ‡‚Babelï¼Ÿä½ å¿…é¡»å¾—å…ˆå¼„æ¸…æ¥šè¿™å‡ ä¸ªåŒ…](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1e1c9aaf995d4f6a84fa861adf38c099~tplv-k3u1fbpfcp-zoom-crop-mark:1512:1512:1512:851.awebp?)

## å‰è¨€

ç›¸ä¿¡å¾ˆå¤šäººéƒ½çŸ¥é“`Babel`ï¼ŒçŸ¥é“å®ƒæ˜¯ç”¨æ¥ç¼–è¯‘`ES6+`çš„ä¸œè¥¿ã€‚ä½†æ˜¯å†æ·±å…¥ä¸€ç‚¹ï¼Œå¤§å®¶éƒ½æ¸…æ¥šæˆ‘ä»¬å¹³æ—¶é¡¹ç›®ä¸­`Babel`ç”¨åˆ°çš„é‚£äº›åŒ…ä½œç”¨æ˜¯ä»€ä¹ˆå—ï¼Ÿä¸ºä»€ä¹ˆè¦ç”¨é‚£å‡ ä¸ªåŒ…ï¼Ÿ

å¦å¤–ï¼Œæˆ‘ä»¬å¹³æ—¶é¡¹ç›®ä¸­`Babel`ç”¨åˆ°çš„åŒ…å…¶å®å¹¶ä¸å¤šï¼ŒåŸºæœ¬å°±æ˜¯æ–‡ç« ä¸­è®²è§£çš„è¿™å‡ ä¸ªåŒ…ï¼Œæ‰€ä»¥å¦‚æœå¤§å®¶èƒ½æŠŠè¿™å‡ ä¸ªåŒ…å¼„å¾—å¾ˆæ¸…æ¥šï¼Œ`Babel`çš„å¤§éƒ¨åˆ†çŸ¥è¯†ä¹Ÿäº†è§£çš„å·®ä¸å¤šäº†ã€‚

ç”±äº`Babel`å†…å®¹å®åœ¨å¤ªå¤šï¼ŒåŠ ä¸Šé…ç½®è®²çš„è¯ï¼Œç¯‡å¹…å¤ªé•¿ï¼Œå¤§å®¶é˜…è¯»ä¹Ÿç´¯ã€‚ä¸ºäº†è®©å¤§å®¶æ›´å¥½åœ°ç†è§£ï¼Œæˆ‘ä»¬æŠŠ`Babel`æ‹†æˆä¸¤éƒ¨åˆ†ï¼ˆ`Babel`äº†è§£ç¯‡ï¼Œ`Babel`é…ç½®ç¯‡ï¼‰æ¥å­¦ä¹ ï¼š

### `Babel`äº†è§£ç¯‡

å°±æ˜¯æœ¬ç¯‡æ–‡ç« ã€‚è„±ç¦»é…ç½®`Babel`è¿™å—ï¼Œç³»ç»Ÿçš„æ¢³ç†ã€ä»‹ç»ã€è®²è§£æˆ‘ä»¬å¹³æ—¶`Babel`ç”¨åˆ°çš„ä¸»è¦å‡ ä¸ªåŒ…ï¼Œå¹¶ä¸”ç­”ç–‘å®˜ç½‘ä¸­ä¸€äº›è®©äººç–‘æƒ‘çš„åœ°æ–¹ã€‚

### `Babel`é…ç½®ç¯‡

å½“æˆ‘ä»¬åœ¨æ¸…æ¥šåœ°ç†è§£äº†`Babel`çš„ä¸»è¦å‡ ä¸ªåŒ…åï¼Œæˆ‘ä»¬å°±èƒ½æ›´å¥½åœ°æ·±å…¥`Babel`æ€ä¹ˆé…ç½®ã€‚

> æƒ³äº†è§£é…ç½®ç¯‡çš„æœ‹å‹ï¼Œå¯ä»¥çœ‹è¿™é‡Œâ€”â€” [Babel é…ç½®ä¸è¦å†â€œå¤åˆ¶ç²˜è´´â€äº†ï¼Œå¸¦ä½ è‡ªå·±é…ä¸€ä¸ª Babel](https://juejin.cn/post/7197666704435920957)

æœ¬ç¯‡æ–‡ç« ç¨å¾®æœ‰ç‚¹é•¿ï¼Œç¬¬ä¸€æ˜¯å› ä¸º`Babel`æœ¬èº«å†…å®¹å°±ç‰¹åˆ«å¤šï¼Œç¬¬äºŒæ˜¯å› ä¸ºæœ‰äº›åŒå­¦çœ‹å®˜ç½‘çš„æ—¶å€™ï¼Œè§‰å¾—å¾ˆéš¾æ‡‚ï¼Œæ‰€ä»¥æ–‡ç« å†™çš„æ¯”è¾ƒè¯¦ç»†ï¼Œå¹¶ä¸”ä¼šç­”ç–‘äº†ä¸€äº›æˆ‘ä»¬å¹³æ—¶çœ‹å®˜ç½‘éš¾æ‡‚çš„åœ°æ–¹ï¼Œæ‰€ä»¥å¸Œæœ›å¤§å®¶å¯ä»¥é™ä¸‹å¿ƒæ¥ï¼Œä¸€ä¸ªæ¨¡å—ä¸€ä¸ªæ¨¡å—çš„çœ‹ï¼Œæ¯ä¸ªæ¨¡å—éƒ½æ˜¯å¾ªåºæ¸è¿›çš„ã€‚ç›¸ä¿¡æˆ‘ï¼Œçœ‹å®Œä½ ä¸€å®šä¼šå¯¹`Babel`æœ‰ä¸€ä¸ª**æ›´æ¸…æ™°çš„ç†è§£**ã€‚

å¤‡æ³¨ï¼š

- å½“å‰`@babel/core`æœ€æ–°ç‰ˆæœ¬æ˜¯ï¼š`7.20.12`
- å½“å‰`@babel/preset-env`æœ€æ–°ç‰ˆæœ¬æ˜¯ï¼š`7.20.2`

## `Babel`

> å®˜ç½‘è§£é‡Šï¼š`Babel`æ˜¯ä¸€ä¸ªå·¥å…·é“¾ï¼Œä¸»è¦ç”¨äºå°†é‡‡ç”¨`ECMAScript 2015+`è¯­æ³•ç¼–å†™çš„ä»£ç è½¬æ¢ä¸ºå‘åå…¼å®¹çš„ `JavaScript`è¯­æ³•ï¼Œä»¥ä¾¿èƒ½å¤Ÿè¿è¡Œåœ¨å½“å‰å’Œæ—§ç‰ˆæœ¬çš„æµè§ˆå™¨æˆ–å…¶ä»–ç¯å¢ƒä¸­ã€‚

æˆ‘ä»¬å¯ä»¥è¿™ä¹ˆç†è§£ï¼Œ`Babel`å°±æ˜¯ä¸€ä¸ªå·¥å…·ã€‚å®ƒæ˜¯ä¸€ä¸ªå¯ä»¥å°†`ES6+`ç­‰æ–°ç‰¹æ€§ï¼Œè½¬æ¢æˆä½ç‰ˆæœ¬æµè§ˆå™¨æˆ–å…¶ä»–ç¯å¢ƒèƒ½æ”¯æŒå¹¶æ­£å¸¸è¿è¡Œçš„ä¸€ä¸ªå·¥å…·ã€‚

### ç»“æ„

å¾ˆå¤šäººä»¥ä¸º`Babel`åªæœ‰`plugins`ã€`presets`ç­‰å‡ ä¸ªé…ç½®ã€‚å…¶å®ä¸æ­¢ï¼Œæˆ‘ä»¬çœ‹çœ‹`Babel`é…ç½®æ–‡ä»¶å¤§è‡´æ¶æ„ï¼š

```javascript
// babel.config.js
module.exports = {
    ...,
    envName: "development",
    plugins: [],
    presets: [],
    passPerPreset: false,
    targets: {},
    browserslistConfigFile: true,
    browserslistEnv: undefined,
    inputSourceMap: true
    ...
}
```

æˆ‘ä»¬ä¸€èˆ¬ä¸»è¦ç”¨åˆ°çš„å°±æ˜¯`plugins`ã€`presets`è¿™ä¸¤ä¸ª

### åŠŸèƒ½

ä»å¤§ä½“ä¸Šçœ‹ï¼Œ`Babel`æä¾›ä»¥ä¸‹ä¸¤ä¸ªåŠŸèƒ½ç»„æˆï¼š

- ç¼–è¯‘`ES6+`æœ€æ–°è¯­æ³•ï¼ˆ`let`ã€`class`ã€`() => {}`ç­‰ï¼‰
- å®ç°æ—§ç‰ˆæœ¬æµè§ˆå™¨ä¸æ”¯æŒçš„`ES6+`çš„`API`ï¼ˆ`Promise`ã€`Symbol`ã€`Array.prototype.includes`ç­‰ï¼‰

å‚è€ƒæ–‡ç« ï¼š

- [What is Babel?](https://babeljs.io/docs/en/)
- [Options](https://babeljs.io/docs/en/options)

## `@babel/core`

ä»`core`å¯ä»¥çœ‹å‡ºï¼Œå®ƒæ˜¯`Babel`å®ç°ç¼–è¯‘çš„æ ¸å¿ƒã€‚æ‰€ä»¥æˆ‘ä»¬å¦‚æœè¦ä½¿ç”¨`Babel`ï¼Œ`@babel/core`è¿™ä¸ªåŒ…ä¸€å®šæ˜¯å¿…ä¸å¯å°‘çš„ã€‚å¦å¤–æˆ‘ä»¬å¹³å¸¸è¯´çš„`Babel 6`ã€`Babel 7`æŒ‡çš„å°±æ˜¯`@babele/core`çš„ç‰ˆæœ¬

å‚è€ƒæ–‡ç« ï¼š[@babel/core](https://babeljs.io/docs/en/babel-core)

## `@babel/cli`

> å®˜ç½‘è§£é‡Šï¼š`Babel`è‡ªå¸¦äº†ä¸€ä¸ªå†…ç½®çš„`CLI`å‘½ä»¤è¡Œå·¥å…·ï¼Œå¯é€šè¿‡å‘½ä»¤è¡Œç¼–è¯‘æ–‡ä»¶

ç®€å•åœ°è¯´å°±æ˜¯ï¼Œè®©æˆ‘ä»¬å¯ä»¥åœ¨**ç»ˆç«¯**é‡Œä½¿ç”¨å‘½ä»¤æ¥ç¼–è¯‘ï¼ˆè¿™æ ·å¯ä»¥æ›´å¥½çš„è°ƒè¯•æ‰“å°ä¿¡æ¯ï¼‰ï¼š

```
npx babel index.js
```

å®‰è£…çš„è¯ï¼Œæˆ‘ä»¬æœ€å¥½å®‰è£…åˆ°æˆ‘ä»¬é¡¹ç›®çš„æœ¬åœ°ç›®å½•ä¸‹ï¼Œå°½é‡ä¸è¦å®‰è£…åˆ°å…¨å±€ï¼ˆå½±å“å…¨å±€çš„ä¸œè¥¿ï¼Œéƒ½å¾ˆå¯æ€•ï¼‰

å‚è€ƒæ–‡ç« ï¼š[@babel/cli](https://babeljs.io/docs/en/babel-cli)

## `@babel/preset-env`

> å®˜ç½‘è§£é‡Šï¼š`@babel/preset-env`æ˜¯ä¸€ä¸ªæ™ºèƒ½é¢„è®¾ï¼Œå®ƒå…è®¸æ‚¨ä½¿ç”¨æœ€æ–°çš„`JavaScript`ï¼Œè€Œæ— éœ€å¾®è§‚ç®¡ç†ç›®æ ‡ç¯å¢ƒéœ€è¦å“ªäº›è¯­æ³•è½¬æ¢ï¼ˆä»¥åŠå¯é€‰çš„æµè§ˆå™¨`polyfill`ï¼‰ã€‚è¿™æ—¢è®©ä½ çš„ç”Ÿæ´»æ›´è½»æ¾ï¼Œä¹Ÿè®©`JavaScript`åŒ…æ›´å°ï¼

### ç†è§£

`@babel/preset-env`è¿™ä¸ªåå­—ï¼Œæˆ‘ä»¬å¯ä»¥æ‹†å¼€ä¸¤éƒ¨åˆ†æ¥çœ‹ï¼Œè¿™æ ·æ–¹ä¾¿ç†è§£ï¼š

- `preset`é¢„è®¾
- `env`ç¯å¢ƒ

#### `preset`

`Babel`ç¼–è¯‘`ES6+`**è¯­æ³•**ï¼Œæ˜¯é€šè¿‡ä¸€ä¸ªä¸ªæ’ä»¶`plugin`å»å®ç°çš„ã€‚æ¯å¹´éƒ½ä¼šæœ‰ä¸åŒæ–°çš„ææ¡ˆã€æ–°çš„è¯­æ³•ï¼Œä½†æˆ‘ä»¬ä¸å¯èƒ½ä¸€ä¸ªä¸ªæ’ä»¶å»é…ç½®ï¼Œæ‰€ä»¥å°±æœ‰äº†`preset`è¿™ä¸ªä¸œè¥¿ã€‚å› æ­¤æˆ‘ä»¬å¯ä»¥ç†è§£æˆ`preset`å°±æ˜¯ä¸€ä¸ª**è¯­æ³•æ’ä»¶é›†åˆåŒ…**ï¼Œè¿™æ ·æˆ‘ä»¬åªç”¨å®‰è£…è¿™ä¸€ä¸ªåŒ…ï¼Œä¸éœ€è¦ä¸€ä¸ªä¸ªé…æ’ä»¶ï¼Œå°±å¯ä»¥å¾ˆæ–¹ä¾¿çš„ç¼–è¯‘æœ€æ–°çš„è¯­æ³•äº†ã€‚

æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªä¸ç”¨é¢„è®¾çš„æ¡ˆä¾‹ [no-preset](https://github.com/limingcan562/learn-babel-7/tree/main/no-preset) ï¼Œæ„Ÿå—ä¸€ä¸‹å¦‚æœä¸ç”¨`preset`æœ‰å¤šéº»çƒ¦ã€‚

```javascript
//  å…¥å£æ–‡ä»¶ index.js
const senses = ["eye", "nose", "ear", "mouth"];

const lMC = {
  senses,
  like: ["eat", "drink", "play", "fun"],
  information: {
    sex: "male",
    age: "18+",
  },
  play: (sport = "badminton") => {
    console.log(`play ${sport}`);
  },
};

const { like, information } = lMC;
```

è¿™æ®µä»£ç ï¼Œæˆ‘ä»¬ç”¨äº†å‡ ä¸ª`ES6`æ–°è¯­æ³•ï¼š

- `const`å£°æ˜
- å±æ€§çš„ç®€æ´è¡¨ç¤ºæ³•
- ç®­å¤´å‡½æ•°
- å‡½æ•°é»˜è®¤å€¼
- æ¨¡æ¿å­—ç¬¦ä¸²
- è§£æ„

å¦‚æœä¸ç”¨`preset`æˆ‘ä»¬`Babel`é…ç½®å¦‚ä¸‹ï¼š

```javascript
// Babelé…ç½®æ–‡ä»¶ babel.config.js
const plugins = [
  "@babel/plugin-transform-arrow-functions",
  "@babel/plugin-transform-block-scoping",
  "@babel/plugin-transform-destructuring",
  "@babel/plugin-transform-parameters",
  "@babel/plugin-transform-shorthand-properties",
  "@babel/plugin-transform-template-literals",
];
module.exports = { plugins };
```

ç¼–è¯‘åçš„æ–‡ä»¶ï¼š

```javascript
// ç¼–è¯‘åçš„æ–‡ä»¶ compile.js
var senses = ["eye", "nose", "ear", "mouth"];
var lMC = {
  senses: senses,
  like: ["eat", "drink", "play", "fun"],
  information: {
    sex: "male",
    age: "18+",
  },
  play: function () {
    var sport =
      arguments.length > 0 && arguments[0] !== undefined
        ? arguments[0]
        : "badminton";
    console.log("play ".concat(sport));
  },
};
var like = lMC.like,
  information = lMC.information;
```

åœ¨ä¸ç”¨`preset`çš„æƒ…å†µä¸‹ï¼Œå®ç°ä¸Šè¿°ç¼–è¯‘çš„è¿‡ç¨‹ï¼Œæˆ‘åŸºæœ¬æ˜¯ç”¨ä¸€ä¸ª`ES6`æ–°è¯­æ³•ï¼Œæˆ‘å°±è¦å»æŸ¥ä¸€ä¸ªæ’ä»¶ï¼Œé¦–å…ˆæˆ‘ä¸è®°å¾—é‚£ä¹ˆå¤šæ’ä»¶ï¼Œå…¶æ¬¡ä¸€ä¸ªä¸ªæ’ä»¶æ‰¾çœŸçš„å¾ˆç´¯ã€‚

okï¼Œé‚£æˆ‘ä»¬å†ç”¨ä¸€ä¸ªä½¿ç”¨äº†é¢„è®¾çš„æ¡ˆä¾‹ [use-preset](https://github.com/limingcan562/learn-babel-7/tree/main/use-preset) ï¼Œæ„Ÿå—ä¸€ä¸‹é¢„è®¾åˆ°åº•æœ‰å¤šæ–¹ä¾¿ã€‚ æˆ‘ä»¬`npm i @babel/preset-env -D`ï¼Œä¿®æ”¹`babel.config.js`ä½¿ç”¨`preset`é¢„è®¾ï¼š

```javascript
// ä¿®æ”¹babel.config.js
const presets = ["@babel/preset-env"];

module.exports = { presets };
```

ç¼–è¯‘åçš„æ–‡ä»¶ï¼š

```javascript
// ç¼–è¯‘åçš„æ–‡ä»¶ compile.js
"use strict";

var senses = ["eye", "nose", "ear", "mouth"];
var lMC = {
  senses: senses,
  like: ["eat", "drink", "play", "fun"],
  information: {
    sex: "male",
    age: "18+",
  },
  play: function play() {
    var sport =
      arguments.length > 0 && arguments[0] !== undefined
        ? arguments[0]
        : "badminton";
    console.log("play ".concat(sport));
  },
};
var like = lMC.like,
  information = lMC.information;
```

æˆ‘ä»¬ä¼šå‘ç°ï¼Œç”¨`preset`ï¼ˆé¢„è®¾ï¼‰æ–¹å¼è¾“å‡ºçš„ä»£ç ï¼Œè·Ÿ`plugins`ï¼ˆä¸ç”¨é¢„è®¾ï¼‰æ–¹å¼è¾“å‡ºçš„ä»£ç æ˜¯å‡ ä¹æ˜¯ä¸€æ¨¡ä¸€æ ·çš„ã€‚ä½†æ˜¯`preset`çš„`babel.config.js`æ›´ç®€æ´ï¼Œæˆ‘ä¹Ÿä¸éœ€è¦ä¸€ä¸ªä¸ªæ’ä»¶å»æ‰¾ï¼Œä¹Ÿä¸éœ€è¦å®‰è£…é‚£ä¹ˆå¤šæ’ä»¶ï¼Œåªç”¨å®‰è£…`@babel/preset-env`è¿™ä¸€ä¸ªåŒ…ï¼Œå°±å¯ä»¥å¾ˆæ„‰å¿«çš„å†™`ES6+`ã€‚

#### `env`

`env`æŒ‡çš„æ˜¯ç¯å¢ƒã€‚å› ä¸º`@babel/preset-env`è¿˜æœ‰ä¸€ä¸ªé…ç½®åŠŸèƒ½ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡é…ç½®æˆ‘ä»¬ä»£ç è¿è¡Œçš„**ç›®æ ‡ç¯å¢ƒ**ï¼Œæ¥æ§åˆ¶`polyfill`ï¼ˆä¸€ä¸ªæä¾›ä½ç‰ˆæœ¬æµè§ˆå™¨ç¼ºå¤±çš„`ES6+`æ–°ç‰¹æ€§çš„æ–¹æ³•ä¸å®ç°çš„é›†åˆ ï¼Œåé¢ä¼šæœ‰æ›´è¯¦ç»†çš„è®²è§£ï¼‰çš„å¯¼å…¥è·Ÿè¯­æ³•ç¼–è¯‘ï¼Œä»è€Œä½¿`ES6+`æ–°çš„ç‰¹æ€§å¯ä»¥åœ¨æˆ‘ä»¬æƒ³è¦çš„**ç›®æ ‡ç¯å¢ƒ**ä¸­é¡ºåˆ©è¿è¡Œã€‚

> å¤‡æ³¨ï¼šå…³äº`@babel/preset-env`çš„é…ç½®åŠŸèƒ½ï¼Œå¯æŸ¥çœ‹è¿™ç¯‡â€”â€”[Babel é…ç½®ä¸è¦å†â€œå¤åˆ¶ç²˜è´´â€äº†ï¼Œå¸¦ä½ è‡ªå·±é…ä¸€ä¸ª Babel](https://juejin.cn/post/7197666704435920957)

### åŠŸèƒ½

é€šè¿‡ä¸Šé¢å¯¹`preset`ã€`env`çš„ç†è§£è·Ÿæ¡ˆä¾‹æ„Ÿå—ï¼Œæˆ‘ä»¬èƒ½æ€»ç»“å‡º`@babel/preset-env`ä¸»è¦æä¾›ä»¥ä¸‹åŠŸèƒ½ï¼š

- å®ƒ**åªç¼–è¯‘`ES6+`è¯­æ³•**ï¼ˆä¸Šè¿°æ¡ˆä¾‹åªä½¿ç”¨äº†`ES6+`çš„è¯­æ³•ï¼Œå¹¶æ²¡æœ‰ç”¨`ES6+`çš„`API`ï¼‰
- å®ƒå¹¶ä¸æä¾›`polyfill`ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡**é…ç½®**æˆ‘ä»¬ä»£ç è¿è¡Œçš„**ç›®æ ‡ç¯å¢ƒ**ï¼Œä»è€Œæ§åˆ¶`polyfill`çš„å¯¼å…¥è·Ÿè¯­æ³•ç¼–è¯‘ï¼Œä½¿`ES6+`çš„æ–°ç‰¹æ€§å¯ä»¥åœ¨æˆ‘ä»¬æƒ³è¦çš„**ç›®æ ‡ç¯å¢ƒ**ä¸­é¡ºåˆ©è¿è¡Œ

### æ³¨æ„

æˆ‘ä»¬å…ˆçœ‹çœ‹`TC39`ææ¡ˆåˆ†ä¸ºå‡ ä¸ªé˜¶æ®µï¼š

- é˜¶æ®µ 0 ï¼ˆ`stage-0`ï¼‰â€”â€”è‰æ ¹ï¼ˆStrawmanï¼‰ï¼šåªæ˜¯ä¸€ä¸ªæƒ³æ³•ï¼Œå¯èƒ½æ˜¯`Babel`æ’ä»¶ã€‚
- ç¬¬ä¸€é˜¶æ®µï¼ˆ`stage-1`ï¼‰â€”â€”ææ¡ˆï¼ˆProposalï¼‰ï¼šè¿™æ˜¯å€¼å¾—ç ”ç©¶çš„ã€‚
- ç¬¬äºŒé˜¶æ®µï¼ˆ`stage-2`ï¼‰â€”â€”è‰æ¡ˆï¼ˆDraftï¼‰ï¼šåˆæ­¥è§„èŒƒã€‚
- ç¬¬ä¸‰é˜¶æ®µï¼ˆ`stage-3`ï¼‰â€”â€”å€™é€‰ï¼ˆCandidateï¼‰ï¼šå®Œæ•´çš„è§„èŒƒå’Œæœ€åˆçš„æµè§ˆå™¨å®ç°ã€‚
- ç¬¬å››é˜¶æ®µï¼ˆ`stage-4`ï¼‰â€”â€”å®Œæˆï¼ˆFinishedï¼‰ï¼šå°†è¢«æ·»åŠ åˆ°ä¸‹ä¸€å¹´åº¦çš„ç‰ˆæœ¬ä¸­ã€‚

å†çœ‹çœ‹å®˜ç½‘ä¸­è¿™æ®µè¯ï¼š

> Note:Â `@babel/preset-env`Â won't include any JavaScript syntax proposals less than Stage 3 because at that stage in the TC39 process, it wouldn't be implemented by any browsers anyway. Those would need to be included manually.

å¤§è‡´æ„æ€æ˜¯ï¼š

- åœ¨`Babel 7`ä»¥åï¼Œ`@babel/preset-env`èˆå¼ƒäº†`Stage presets`ï¼ˆ`@babel/preset-stage-x`ï¼‰è¿™ç§é¢„è®¾
- `@babel/preset-env`åªæä¾›`TC39`å¤§äº`stage-3`çš„ææ¡ˆï¼ˆå³åªåŒ…å«`stage-4`é˜¶æ®µï¼‰ï¼Œå› æ­¤å¦‚æœè¦ç”¨å°äº`stage 4`çš„ææ¡ˆè¯­æ³•ï¼Œåˆ™å¿…é¡»å…ˆå®‰è£…å†æ‰‹åŠ¨å¼•å…¥å¯¹åº”æ’ä»¶

ç¬¬ä¸€ç‚¹ç›¸ä¿¡å¤§å®¶éƒ½å¾ˆå¥½ç†è§£ï¼Œæˆ‘ä»¬æ¥ç†è§£ä¸€ä¸‹ç¬¬äºŒç‚¹æ˜¯ä»€ä¹ˆæ„æ€ã€‚

æ„æ€æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬æƒ³ç”¨ä¸€äº›å°äº`stage-4`é˜¶æ®µçš„è¯­æ³•çš„è¯ï¼Œå…‰å®‰è£…`@babel/preset-env`è¿™ä¸€ä¸ªåŒ…æ˜¯æ²¡æœ‰ç”¨çš„ï¼Œå› ä¸ºè¿™ä¸ªåŒ…é‡ŒåªåŒ…å«ç¼–è¯‘`stage-4`çš„é¢„è®¾ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±å¾—å®‰è£…å¹¶é…ç½®ç›¸åº”çš„`plugin`å»ç¼–è¯‘ã€‚

åœ¨å†™è¿™ç¯‡æ–‡ç« çš„æ—¶å€™ï¼Œæœ‰ä¸€ä¸ªæ–°çš„è¯­æ³• [doÂ expressions](https://github.com/tc39/proposal-do-expressions) ï¼Œå®ƒå½“å‰æ˜¯å¤„äº`stage-1`é˜¶æ®µçš„è¯­æ³•ï¼Œç”¨æ’ä»¶`@babel/plugin-proposal-do-expressions`å¯ä»¥ç¼–è¯‘è¿™ä¸ªè¯­æ³•ã€‚

![pic.jpeg](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1d8609a462fa4b98945f5444a6a047c2~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp?)

> å®˜ç½‘è§£é‡Šï¼šdo { .. } è¡¨è¾¾å¼æ‰§è¡Œä¸€ä¸ªå—ï¼ˆå…¶ä¸­æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªè¯­å¥ï¼‰ï¼Œå—å†…çš„æœ€ç»ˆè¯­å¥å®Œæˆå€¼æˆä¸º do è¡¨è¾¾å¼çš„å®Œæˆå€¼ã€‚

æˆ‘ä»¬å€ŸåŠ©[å®˜ç½‘](ttps://www.babeljs.cn/docs/babel-plugin-proposal-do-expressions)ï¼Œæ•´ç†æˆè¿™ä¸ªæ¡ˆä¾‹ [compile-stage-1](https://github.com/limingcan562/learn-babel-7/tree/main/compile-stage-1) æ¥çœ‹çœ‹æ€ä¹ˆä½¿ç”¨å°äº`stage-4`çš„è¯­æ³•ã€‚

æˆ‘ä»¬å…ˆåªç”¨`@babel/preset-env`ï¼Œçœ‹çœ‹èƒ½ä¸èƒ½ç¼–è¯‘`do {...}`è¿™ä¸ªè¯­æ³•ã€‚

```javascript
// do expressions stage-1è¯­æ³•
let x = 100;
let y = 20;

let a = do {
  if (x > 10) {
    if (y > 20) {
      ("big x, big y");
    } else {
      ("big x, small y");
    }
  } else {
    if (y > 10) {
      ("small x, big y");
    } else {
      ("small x, small y");
    }
  }
};
```

`Babel.config.js`é…ç½®ï¼š

```javascript
const presets = ["@babel/preset-env"];

// const plugins = [
// '@babel/plugin-proposal-do-expressions'
// ];

// module.exports = {plugins, presets};

module.exports = { presets };
```

æˆ‘ä»¬ä¼šå‘ç°ç»ˆç«¯æŠ¥é”™ï¼š

![compole-stage-1.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/add374df2526429d8da9b2a65a8ba5d2~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp?)

å¤§è‡´æ„æ€æ˜¯ï¼š`@babel/preset-env`å½“å‰æœªå¯ç”¨å¯¹å®éªŒè¯­æ³•`doExpressions`çš„æ”¯æŒï¼ˆå› ä¸º`doExpressions`å½“å‰æ˜¯`stage-1`çš„è¯­æ³•ï¼Œ`@babel/preset-env`åªåŒ…å«å¿…ç¼–è¯‘`stage-4`çš„è¯­æ³•æ’ä»¶ï¼‰ï¼Œéœ€è¦æˆ‘ä»¬åŠ å…¥`@babel/plugin-proposal-do-expressions`æ’ä»¶å»ç¼–è¯‘ã€‚

é‚£æˆ‘ä»¬`npm i @babel/plugin-proposal-do-expressions -D`ï¼Œä¿®æ”¹ä¸€ä¸‹`babel.config.js`ï¼š

```javascript
const presets = ["@babel/preset-env"];

const plugins = ["@babel/plugin-proposal-do-expressions"];

module.exports = { plugins, presets };

// module.exports = {presets};
```

æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå¯ä»¥æ­£å¸¸è¾“å‡ºç¼–è¯‘åçš„æ–‡ä»¶ï¼š

```javascript
"use strict";

var x = 100;
var y = 20;
var a =
  x > 10
    ? y > 20
      ? "big x, big y"
      : "big x, small y"
    : y > 10
    ? "small x, big y"
    : "small x, small y";
```

æ‰€ä»¥ï¼Œå½“æˆ‘ä»¬æƒ³ä½¿ç”¨å°äº`stage-4`é˜¶æ®µçš„è¯­æ³•æ—¶ï¼Œæˆ‘ä»¬è¦å…ˆæ‰¾åˆ°**å…¶å¯¹åº”çš„ç¼–è¯‘æ’ä»¶**å®‰è£…ï¼Œç„¶ååœ¨`plugins`é‡Œé¢é…ç½®å°±å¥½äº†ã€‚

å‚è€ƒæ–‡ç« ï¼š

- [TC39 proposals](https://github.com/tc39/proposals)
- [proposal-do-expressions](https://github.com/tc39/proposal-do-expressions)
- [@babel/plugin-proposal-do-expressions](https://www.babeljs.cn/docs/babel-plugin-proposal-do-expressions)

### è¡¥å……

æœ‰æ—¶æˆ‘ä»¬ä¹Ÿå¯èƒ½éœ€è¦çŸ¥é“æˆ‘ä»¬å½“å‰çš„`preset`ï¼ˆé¢„è®¾ï¼‰åŒ…å«äº†å“ªäº›æ’ä»¶ï¼Œé‚£æˆ‘ä»¬æ€ä¹ˆæŸ¥çœ‹å½“å‰`@babel/preset-env`åŒ…å«äº†å“ªäº›é¢„è®¾å‘¢ï¼Ÿ

æˆ‘ä»¬å¯ä»¥é€šè¿‡æŸ¥çœ‹`@babel/preset-env` --> `package.json` --> `dependencies`é‡Œé¢å¯ä»¥æ‰¾åˆ°ã€‚æˆ‘ç›®å‰å®‰è£…çš„`@babel/preset-env`ç‰ˆæœ¬ä¸º`7.20.2`ï¼Œå®ƒåŒ…å«äº†ä»¥ä¸‹é¢„è®¾ï¼š

```js
// @babel/preset-env@7.20.2é¢„è®¾
"dependencies": {
    "@babel/plugin-bugfix-safari-id-destructuring-collision-in-function-expression": "^7.18.6",
    "@babel/plugin-bugfix-v8-spread-parameters-in-optional-chaining": "^7.18.9",
    ...,
    "@babel/plugin-transform-sticky-regex": "^7.18.6",
    "@babel/plugin-transform-template-literals": "^7.18.9",
    "@babel/plugin-transform-typeof-symbol": "^7.18.9",
    "@babel/plugin-transform-unicode-escapes": "^7.18.10",
    "@babel/plugin-transform-unicode-regex": "^7.18.6",
  },
```

## `polyfill`

### åŠŸèƒ½

`ES6+`é™¤äº†æä¾›å¾ˆå¤šç®€æ´çš„è¯­æ³•ï¼ˆ`let`ã€`class`ã€`() => {}`ç­‰ï¼‰å¤–ï¼Œè¿˜ä¸ºæˆ‘ä»¬æä¾›äº†å¾ˆå¤šä¾¿æ·çš„`API`ï¼ˆ`Promise`ã€`Symbol`ã€`Array.prototype.includes`ç­‰ï¼‰ã€‚ä½†**æ—§ç‰ˆæœ¬æµè§ˆå™¨æ˜¯ä¸æ”¯æŒè¿™äº›`API`çš„**ï¼Œè€Œ`polyfill`å­˜æ”¾äº†è¿™äº›`API`çš„æ–¹æ³•ä¸å®ç°ï¼Œæ‰€ä»¥å®ƒå¯ä»¥ä½¿å¾—è¿™äº›ä¸æ”¯æŒçš„æµè§ˆå™¨ï¼Œæ”¯æŒè¿™äº›`API`ã€‚

### ç†è§£

æˆ‘ä»¬å¯ä»¥æŠŠæ‰€æœ‰è¿™ç§å­˜æ”¾äº†`ES6+` `API`çš„**æ–¹æ³•ä¸å®ç°çš„é›†åˆ**å«åš`polyfill`ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ç»å¸¸è¯´çš„**å«ç‰‡**ã€‚ï¼ˆå¦‚æœæŠŠæˆ‘ä»¬çš„æ—§ç‰ˆæœ¬æµè§ˆå™¨ç¼ºå¤±çš„`API`å½“åšä¸€ä¸ªä¸ªå‘ï¼Œ`polyfill`å°±æ˜¯ç”¨æ¥æŠŠè¿™äº›å‘å¡«å¹³ï¼‰

`polyfill`ä¹Ÿåˆ†å¾ˆå¤šç§ï¼Œåƒ`core-js`æ˜¯ä¼šæä¾›æ—§ç‰ˆæœ¬æµè§ˆå™¨ç¼ºå¤±çš„**æ‰€æœ‰**çš„`API`ï¼›è¿˜æœ‰ä¸€äº›åªæä¾›ç¼ºå¤±`API`çš„**æŸå—**ï¼Œä¾‹å¦‚ [promise-polyfill](https://github.com/taylorhakes/promise-polyfill%5B)ã€[proxy-polyfill](https://github.com/GoogleChrome/proxy-polyfill) ç­‰ã€‚

`Babel`é…ç½®`polyfill`çš„è¿‡ç¨‹ï¼Œå°±æ˜¯å®ç°æ—§ç‰ˆæœ¬æµè§ˆå™¨å¯¹è¿™äº›`API`æ”¯æŒçš„è¿‡ç¨‹ã€‚

## `@babel/polyfill`

ä¸Šé¢æˆ‘ä»¬è§£é‡Šäº†`polyfill`æ˜¯ä»€ä¹ˆï¼Œä»åŒ…å`@babel/polyfill`å°±çŸ¥é“ï¼Œå®ƒå°±æ˜¯ä¸€ä¸ª`polyfill`ï¼ˆå…¶æ ¸å¿ƒæ˜¯ä¾é `core-js@2.x.x`å®ç°ï¼‰ã€‚è™½ç„¶è¿™ä¸ªåŒ…å·²ç»è¢«åºŸå¼ƒäº†ï¼Œä½†æˆ‘ä»¬è¿˜æ˜¯ç¨å¾®äº†è§£ä¸€ä¸‹å®ƒã€‚

> **å®˜ç½‘è§£é‡Šï¼š**  
> ğŸš¨ ä» Babel 7.4.0 å¼€å§‹ï¼Œè¿™ä¸ªåŒ…å·²ç»è¢«å¼ƒç”¨ï¼Œè½¬è€Œç›´æ¥åŒ…å«`core-js/stable`ï¼ˆç”¨äº`polyfill ECMAScript`åŠŸèƒ½ï¼‰
>
> **ä½¿ç”¨ï¼š**
>
> ```javascript
> import "core-js/stable";
> ```

### åˆè¯†

æˆ‘ä»¬é€šè¿‡è¿™ä¸ªä¾‹å­ [know-babel-polyfill](https://github.com/limingcan562/learn-babel-7/tree/main/know-babel-polyfill)ï¼Œæ¥äº†è§£ä¸€ä¸‹`@babel/polyfill`çš„ç»„æˆã€‚ [know-babel-polyfill](https://github.com/limingcan562/learn-babel/tree/main/know-babel-polyfill) ä»€ä¹ˆéƒ½æ²¡å®‰è£…ï¼Œåªå®‰è£…äº†`@babel/polyfill`è¿™ä¸ªä¾èµ–ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆæ¸…æ¥šçœ‹åˆ°ï¼Œ`@babel/polyfill`ç”±ä»¥ä¸‹ä¸¤ä¸ªåŒ…ç»„æˆï¼š

![babel-polyfill.jpeg](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8ff1acb6c6e2463aad5798f805f3efd8~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp?)

- `core-js`ï¼ˆ**ç‰ˆæœ¬ä¸º`2`**ï¼‰
- `regenerator-runtime`

æˆ‘ä»¬æ¥å¤§è‡´ç†è§£ä¸€ä¸‹è¿™ä¸¤åŒ…æ˜¯ä»€ä¹ˆï¼š

#### `core-js`

è¿™ä¸ªåŒ…å°±æ˜¯æˆ‘ä»¬ä¸Šè¿°`polyfill`æ¨¡å—æ‰€è¯´çš„ï¼Œé‡Œé¢å­˜æ”¾äº†å¾ˆå¤š`ES6+` `API`çš„æ–¹æ³•ä¸å®ç°ã€‚å¦‚æœè¦åœ¨æ—§æµè§ˆç”¨åˆ°`Promise`ã€`Symbol`ã€`Array.prototype.includes`ç­‰æ–¹æ³•æ—¶ï¼Œè¿™ä¸ªåŒ…ä¼šä¸ºæˆ‘ä»¬æä¾›ã€‚å®ƒå¯ä»¥ä½¿é‚£äº›ä¸æ”¯æŒ`API`çš„æµè§ˆå™¨ï¼Œæ”¯æŒè¿™äº›`API`ï¼Œå®ƒå°±æ˜¯ä¸€ç§å«ç‰‡ã€‚

> **ç‰¹åˆ«æ³¨æ„**ï¼šç”±ä¸Šå›¾å¯çŸ¥ï¼Œ`@babel/polyfill`æ˜¯ä¸`2`ç‰ˆæœ¬çš„`core-js`ç»‘å®šçš„ï¼Œ`2`ç‰ˆæœ¬çš„`core-js`å¹¶ä¸åŒ…å«`stable`è¿™ä¸ªæ–‡ä»¶å¤¹çš„ã€‚å› æ­¤å®˜ç½‘è¯´çš„`import "core-js/stable"`ï¼Œå®é™…ä¸Šæ˜¯è¦æˆ‘ä»¬å®‰è£…`core-js@3.x.x`ç‰ˆæœ¬æ¥ä»£æ›¿`@babel/polyfill`ï¼Œå› ä¸ºä»`3`ç‰ˆæœ¬å¼€å§‹ï¼Œæ‰æœ‰`stable`è¿™ä¸ªæ–‡ä»¶å¤¹

#### `regenerator-runtime`

æˆ‘ä»¬çš„æºç é‡Œé¢ä½¿ç”¨äº†`async function() {}`ç­‰å¼‚æ­¥å‡½æ•°ï¼Œæˆ–è€…`fuction* myGenerator() {}`è¿™ç§`Generator`å‡½æ•°çš„è¯ï¼Œå°±ä¼šéœ€è¦ç”¨åˆ°è¿™ä¸ªåŒ…æ¥ç¼–è¯‘ã€‚

### æ€»ç»“

æ‰€ä»¥å¯¹äº`@babel/polyfill`ï¼Œæˆ‘ä»¬æœ‰ä»¥ä¸‹æ€»ç»“ï¼š

- è¿™ä¸ªåŒ…ç”±`core-js`ï¼ˆ**ç‰ˆæœ¬ä¸º`2.x.x`**ï¼‰ä¸`regenerator-runtime`ä¸¤ä¸ªåŒ…ç»„æˆ
- è¿™ä¸ªåŒ…åœ¨`Babel 7.4.0`ä»¥åå°±åºŸå¼ƒäº†ï¼Œæ‰€ä»¥åœ¨`Babel 7.4.0`ä»¥åï¼Œæˆ‘ä»¬æƒ³è®©ä¸€äº›ä¸æ”¯æŒ`ES6+`Â `API`çš„æ—§ç‰ˆæœ¬æµè§ˆå™¨æ”¯æŒè¿™äº›`API`ï¼Œåº”è¯¥ç›´æ¥å®‰è£…`core-js@3.x.x`çš„åŒ…ï¼ˆ**ä¸è¦å®‰è£…`2.x.x`çš„ç‰ˆæœ¬ï¼Œå·²ç»ä¸ç»´æŠ¤äº†ï¼Œç›®å‰æœ€æ–°ç‰ˆæœ¬ä¸º`3.x.x`**ï¼›å¹¶ä¸”**åªæœ‰`3.x.x`çš„ç‰ˆæœ¬æ‰æœ‰`stable`è¿™ä¸ªæ–‡ä»¶å¤¹**ï¼‰

å‚è€ƒæ–‡ç« ï¼š[@babel/polyfill](https://babeljs.io/docs/en/babel-polyfill)

## `core-js`

### æ¦‚è¿°

é€šè¿‡ä¸Šé¢`polyfill`ã€`@babel/polyfill`ä¸¤ä¸ªæ¨¡å—ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“å®ƒæ˜¯ä¸€ä¸ªå«ç‰‡ï¼Œå®ƒä¼šæä¾›æ—§ç‰ˆæœ¬æµè§ˆå™¨ç¼ºå¤±çš„**æ‰€æœ‰**çš„`API`ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦åœ¨æ—§æµè§ˆå™¨ç”¨åˆ°`ES6+` `API`æ—¶ï¼Œæˆ‘ä»¬ç›´æ¥å®‰è£…`core-js@3.x.x`è¿™ä¸ªåŒ…ã€‚

é€šè¿‡ [å®˜æ–¹çš„ä»‹ç»](https://github.com/zloirock/core-js#babelpolyfill)ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼š

```javascript
import "@babel/polyfill";
```

ç­‰åŒäº

```javascript
// core-jså¿…é¡»æ˜¯3.x.xç‰ˆæœ¬ï¼Œå› ä¸º2.x.xç‰ˆæœ¬ï¼Œä¸åŒ…å«stableæ–‡ä»¶å¤¹
import "core-js/stable";
import "regenerator-runtime/runtime";
```

`Babel >= 7.18.0`ç­‰åŒäº

```javascript
// core-jså¿…é¡»æ˜¯3.x.xç‰ˆæœ¬ï¼Œå› ä¸º2.x.xç‰ˆæœ¬ï¼Œä¸åŒ…å«stableæ–‡ä»¶å¤¹
// Babel >= 7.18.0å ä¸éœ€è¦å† import "regenerator-runtime/runtime";
import "core-js/stable";
```

### æ³¨æ„

æˆ‘ä»¬é’ˆå¯¹ä¸éœ€è¦å†`import "regenerator-runtime/runtime"`è¿™å—ï¼Œç¨å¾®è§£é‡Šä¸€ä¸‹ï¼ŒåŠ æ·±ä¸€ä¸‹æˆ‘ä»¬å¯¹`Babel`è·Ÿå®˜ç½‘æ–‡æ¡£çš„ç†è§£ã€‚

æˆ‘ä»¬çœ‹å®˜æ–¹è¿™æ®µè¯ï¼š

> If you are compiling generators or async function to `ES5`, and you are using a version ofÂ `@babel/core`Â orÂ `@babel/plugin-transform-regenerator`Â older thanÂ `7.18.0`, you must also load theÂ [regenerator-runtime](https://github.com/facebook/regenerator/tree/main/packages/runtime)Â package

å¤§å®¶çœ‹è¿™å¥è¯çš„æ—¶å€™å¯èƒ½æœ‰ç‚¹ç–‘æƒ‘ï¼Œå…¶å®å®ƒçš„æ„æ€å°±æ˜¯ï¼š

å¦‚æœæˆ‘ä»¬è¦æŠŠ`async function() {}`ç­‰å¼‚æ­¥å‡½æ•°ï¼Œæˆ–è€…`fuction* myGenerator() {}`è¿™ç§`Generator`å‡½æ•°ç¼–è¯‘æˆ`ES5`ï¼Œå¹¶ä¸”`@babel/core`æˆ–`@babel/plugin-transform-regenerator`å°äº`7.18.0`ï¼Œæˆ‘ä»¬å°±éœ€è¦æ‰‹åŠ¨`import "regenerator-runtime/runtime"`è¿™ä¸ªåŒ…ã€‚

ä½†åœ¨`Babel 7.18.0`æˆ–è€…`@babel/plugin-transform-regenerator 7.18.0`åŠå…¶ä»¥åçš„ç‰ˆæœ¬ï¼Œ`regenerator-runtime`åŒ…é‡Œé¢çš„å†…å®¹ä¼šè¢«**å†…è”ç¼–è¯‘**åˆ°æˆ‘ä»¬çš„ä»£ç ä¸­ï¼Œæ‰€ä»¥æˆ‘ä»¬åªç”¨å¼•å…¥`import "core-js/stable"`è¿™ä¸€ä¸ªåŒ…å°±å¯ä»¥äº†ã€‚

æˆ‘ä»¬æ¥ç”¨ä¸¤ä¸ªä¾‹å­ç»“åˆ`Webpack`æ‰“åŒ…å‡ºæ¥ï¼Œåœ¨æµè§ˆå™¨è¿è¡Œï¼Œè¿™æ ·æ›´ç›´è§‚çš„ç†è§£æ„Ÿå—ä¸€ä¸‹ã€‚

#### `Babel < 7.18.0`

æˆ‘ä»¬ç”¨è¿™ä¸ªä¾‹å­ [import-regenerator-runtime](https://github.com/limingcan562/learn-babel-7/tree/main/import-regenerator-runtime) çœ‹çœ‹åœ¨`Babel 7.18.0`ä¹‹å‰ä¸ºä»€ä¹ˆè¦æ‰‹åŠ¨å¼•å…¥`regenerator-runtime`è¿™ä¸ªåŒ…ã€‚

> **ç‰¹åˆ«è¯´æ˜ï¼š** æˆ‘ä»¬ä¾‹å­å®‰è£…`Babel`çš„ç‰ˆæœ¬ä¸º`7.16.7`ï¼Œ`@babel/plugin-transform-regenerator`è¿™ä¸ªæ’ä»¶å¿…é¡»**æ‰‹åŠ¨å®‰è£…ä¸ºå°äº`7.18.0`çš„ç‰ˆæœ¬**ï¼ˆå› ä¸ºæˆ‘ä»¬å®‰è£…ä¾èµ–çš„æ—¶å€™ï¼Œå³ä½¿æŒ‡å®šäº†ä¾èµ–çš„ç‰ˆæœ¬ï¼Œä½†ä¾èµ–çš„ä¾èµ–å®‰è£…æ—¶ï¼Œå¯èƒ½ä¼šæ˜¯æœ€æ–°çš„ï¼Œè¿™æ ·å¯èƒ½ä¼šçœ‹ä¸å‡ºæ•ˆæœã€‚æ‰€ä»¥ä¸ºä»€ä¹ˆæœ‰æ—¶æˆ‘ä»¬å¯¹ç€å®˜ç½‘æ•²`Demo`å®é™…å‡ºæ¥çš„ç»“æœä¸ä¸€æ ·ï¼Œå› ä¸ºç‰ˆæœ¬æ²¡å¯¹ä¸Šï¼‰ã€‚å¯ä»¥é€šè¿‡`package-lock.json`æŸ¥çœ‹å„ä¸ªä¾èµ–ç‰ˆæœ¬

okï¼Œæ¥çœ‹çœ‹æˆ‘ä»¬çš„å…¥å£æ–‡ä»¶ï¼ˆ`index.js`ï¼‰ï¼š

```javascript
// å…ˆä¸å¼•å…¥regenerator-runtime/runtime

// import 'regenerator-runtime/runtime';
const sleep = async function () {
  setTimeout(() => console.log("get up"), 1000);
};
sleep();
```

æ¥ç€æˆ‘ä»¬æ‰“åŒ…ï¼ˆ`Webpack`æ‰“åŒ…å‡ºæ¥çš„æ–‡ä»¶åœ¨`dist/dist.js`ï¼‰åœ¨æµè§ˆå™¨è¿è¡Œã€‚æ­£å¸¸æƒ…å†µä¸‹ï¼Œæµè§ˆå™¨åº”è¯¥ä¼šè¿‡ä¸€ç§’åè¾“å‡º`get up`ã€‚ä½†å®é™…æƒ…å†µå¦‚ä¸‹ï¼Œæˆ‘ä»¬ä¼šå‘ç°ä¹‹å‰ç½‘å‹ä»¬ç»å¸¸å‡ºç°çš„ä¸€ä¸ªé—®é¢˜â€”â€”`regeneratorRuntime is not defined`ï¼š

![no-import-regenerator-runtime.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/710d48e195df4fceba8a1413c782d704~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp?)

è¯´æ˜ç¼ºå¤±äº†`regeneratorRuntime`ï¼Œæˆ‘ä»¬å†çœ‹çœ‹`Babel`ç¼–è¯‘åçš„æ–‡ä»¶ï¼ˆ`compile.js`ï¼‰ï¼š

![](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f4e464c2bf2740f4ac9bab5680c2cf0d~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp?)

æˆ‘ä»¬å‘ç°åœ¨å…¨å±€ä¸­ï¼Œ`regeneratorRuntime`æ ¹æœ¬æ²¡æœ‰å®šä¹‰ï¼Œæ‰€ä»¥æ‰æŠ¥äº†`regeneratorRuntime is not defined`çš„é”™ã€‚

å¦‚æœæˆ‘ä»¬å†æ‰‹åŠ¨å¼•å…¥ä¸€ä¸‹`import "regenerator-runtime/runtime"`ï¼š

```javascript
import "regenerator-runtime/runtime";

const sleep = async function () {
  setTimeout(() => console.log("get up"), 1000);
};
sleep();
```

æ­¤æ—¶æµè§ˆå™¨è¾“å‡ºï¼š

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6a793d7f8c024a99b26756c801df8f83~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp?)

å½“æˆ‘ä»¬æ‰‹åŠ¨å¼•å…¥ä»¥åï¼Œæµè§ˆå™¨å¯ä»¥æ­£å¸¸è¿è¡Œäº†ã€‚

è¿™è¯´æ˜ï¼Œåœ¨`@babel/core`æˆ–`@babel/plugin-transform-regenerator`çš„ç‰ˆæœ¬å°äº`7.18.0`çš„æ—¶å€™ï¼Œä½¿ç”¨äº†å¼‚æ­¥å‡½æ•°ï¼ˆ`async function() {}`ï¼‰ï¼Œæˆ–è€…`Generator`è¿™ç§å‡½æ•°ï¼ˆ`fuction* myGenerator() {}`ï¼‰çš„è¯ï¼Œæ˜¯éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨å¼•å…¥`regenerator-runtime`è¿™ä¸ªåŒ…çš„ï¼Œå› ä¸º`regenerator-runtime`**è¿™ä¸ªåŒ…ä¼šä¸ºæˆ‘ä»¬æä¾›`regeneratorRuntime`è¿™ä¸ªå…¨å±€å¯¹è±¡**ã€‚

#### `Babel >= 7.18.0`

æˆ‘ä»¬ç”¨è¿™ä¸ªä¾‹å­ [no-import-regenerator-runtime](https://github.com/limingcan562/learn-babel-7/tree/main/no-import-regenerator-runtime) çœ‹çœ‹åœ¨`Babel 7.18.0`ä¹‹åä¸ºä»€ä¹ˆä¸éœ€è¦æ‰‹åŠ¨å¼•å…¥`regenerator-runtime`è¿™ä¸ªåŒ…ã€‚ï¼ˆ`@babel/core`ç‰ˆæœ¬ä¸º`7.20.12`ï¼‰

okï¼Œæ¥çœ‹çœ‹æˆ‘ä»¬çš„å…¥å£æ–‡ä»¶ï¼Œè¿™æ—¶ä¸å†æ‰‹åŠ¨å¼•å…¥`regenerator-runtime`è¿™ä¸ªåŒ…ï¼š

```javascript
const sleep = async function () {
  setTimeout(() => console.log("get up"), 1000);
};
sleep();
```

ç¼–è¯‘å‡ºåŒ…ä»¥ååœ¨æµè§ˆå™¨è¿è¡Œï¼Œå¾—åˆ°è·Ÿä¸Šè¿°æ‰‹åŠ¨å¼•å…¥`regenerator-runtime`è¿™ä¸ªåŒ…ä¸€æ¨¡ä¸€æ ·çš„æ•ˆæœï¼š

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6a793d7f8c024a99b26756c801df8f83~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp?)

æˆ‘ä»¬å†çœ‹çœ‹`Babel`ç¼–è¯‘åçš„æ–‡ä»¶ï¼š

![no-import-regenerator-runtime.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9f923b96597f4f0c948b82b5b2f01f6d~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp?)

æˆ‘ä»¬ä¼šå‘ç°ï¼Œ`regenerator-runtime`åŒ…é‡Œçš„å†…å®¹ï¼Œä¼šä»¥**å±€éƒ¨å˜é‡çš„æ–¹å¼å†…è”æ³¨å…¥åˆ°æˆ‘ä»¬çš„ä»£ç ä¸­**ï¼Œè¿™æ ·æˆ‘ä»¬å°±ä¸éœ€è¦å…¨å±€æä¾›ä¸€ä¸ª`regeneratorRuntime`å¯¹è±¡äº†ã€‚

æ‰€ä»¥ï¼Œåœ¨`Babel >= 7.18.0`ä»¥åï¼Œæˆ‘ä»¬ç›´æ¥`import "core-js/stable";`å°±å¥½

å‚è€ƒæ–‡ç« ï¼š

- [core-js](https://github.com/zloirock/core-js#babelpolyfill)
- [@babel/polyfill](https://babeljs.io/docs/en/babel-polyfill)
- [InlineÂ regenerator-runtimeÂ helper](https://babeljs.io/blog/2022/05/19/7.18.0#inline-regenerator-runtime-helper-14538httpsgithubcombabelbabelpull14538)

## `@babel/runtime`

> å®˜æ–¹è§£é‡Šï¼š`@babel/runtime`æ˜¯ä¸€ä¸ªåŒ…å«`Babel`æ¨¡å—åŒ–è¿è¡Œæ—¶åŠ©æ‰‹çš„åº“

åœ¨`Babel`ç¼–è¯‘çš„æ—¶å€™ï¼Œä¼šæœ‰ä¸€äº›è¾…åŠ©å‡½æ•°ï¼Œè¿™äº›å‡½æ•°å°±æ˜¯`ES6+`ä¸€äº›è¯­æ³•ç³–çš„å®ç°ï¼Œæˆ‘ä»¬ç”¨è¿™ä¸ªæ¡ˆä¾‹ [helper-functions](https://github.com/limingcan562/learn-babel-7/tree/main/helper-functions) çœ‹çœ‹è¾…åŠ©å‡½æ•°æ˜¯ä»€ä¹ˆã€‚

æˆ‘ä»¬ç”¨`Babel`ç¼–è¯‘ä¸€ä¸‹`class`è¿™ä¸ªè¯­æ³•ç³–ï¼š

```javascript
class People {
  constructor() {}
}
const person = new Person();
```

ç¼–è¯‘ä»¥åï¼š

![heplper-functions.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ad77cf190cbe4a11b245cfd4ba2eea49~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp?)

æˆ‘ä»¬å…ˆçœ‹çº¢è‰²æ¡†ï¼Œå®ƒæ˜¯`Babel`ç¼–è¯‘åçš„ä»£ç ã€‚æˆ‘ä»¬ä¼šå‘ç°ï¼Œç¼–è¯‘ä»¥åç”Ÿæˆå¾ˆå¤šå‡½æ•°ï¼Œå¹¶ä¸”ä¼šä»¥**å†…è”**çš„æ–¹å¼æ’å…¥åˆ°æˆ‘ä»¬çš„ä»£ç ä¸­ï¼Œè¿™äº›å‡½æ•°å°±æ˜¯æˆ‘ä»¬è¯´çš„**è¾…åŠ©å‡½æ•°**ã€‚

æˆ‘ä»¬å†çœ‹è“è‰²æ¡†ï¼Œå®ƒæ˜¯`@babel/runtime`çš„å†…å®¹ï¼Œå®ƒåœ¨`node_modules/@babel/runtime/helpers`ã€‚

æˆ‘ä»¬æœ€åæ¥çœ‹çœ‹ç™½è‰²æ¡†ï¼Œä¼šå‘ç°`Babel`ç¼–è¯‘åçš„è¾…åŠ©å‡½æ•°ï¼Œéƒ½å¯ä»¥åœ¨`@babel/runtime`é‡Œé¢æ‰¾åˆ°ã€‚

æ‰€ä»¥`@babel/runtime`æ˜¯**å­˜æ”¾äº†`Babel`è¾…åŠ©å‡½æ•°çš„ä¸€ä¸ªé›†åˆåŒ…**ã€‚

å‚è€ƒæ–‡ç« ï¼š[@babel/runtime](https://babeljs.io/docs/en/babel-runtime)

## `@babel/plugin-transform-runtime`

> å®˜æ–¹è§£é‡Šï¼šä¸€ä¸ªæ’ä»¶ï¼Œå¯ä»¥é‡ç”¨`Babel`æ³¨å…¥çš„å¸®åŠ©ç¨‹åºä»£ç ä»¥èŠ‚çœä»£ç å¤§å°

é€šè¿‡ä¸Šé¢`@babel/runtime`æ¨¡å—çš„äº†è§£ï¼Œæˆ‘ä»¬çŸ¥é“å½“æˆ‘ä»¬ä½¿ç”¨äº†ä¸€äº›`ES6+`çš„è¯­æ³•ç³–æ—¶ï¼Œ`Babel`ä¼šç”Ÿæˆä¸€äº›è¾…åŠ©å‡½æ•°æ¥ç¼–è¯‘è¿™äº›è¯­æ³•ç³–ï¼Œå¹¶ä»¥**å†…è”çš„æ–¹å¼æ’å…¥**åˆ°ä»£ç ä¸­ã€‚

é‚£å¦‚æœæˆ‘ä»¬æœ‰ 10 ä¸ªæ–‡ä»¶éƒ½ç”¨åˆ°äº†è¯­æ³•ç³–ï¼Œé‚£è¿™äº›è¾…åŠ©å‡½æ•°ï¼Œæ˜¯ä¸æ˜¯ä¼šç”Ÿæˆ 10 æ¬¡ï¼Œå¹¶å†…è”æ’å…¥ 10 æ¬¡å‘¢ï¼Ÿæˆ‘ä»¬ç”¨è¿™ä¸ªæ¡ˆä¾‹ [no-use-transform-runtime](https://github.com/limingcan562/learn-babel-7/tree/main/no-use-transform-runtime) æ¥æ„Ÿå—ä¸€ä¸‹ã€‚

æˆ‘ä»¬å®šä¹‰äº†ä¸‰ä¸ªæ–‡ä»¶ï¼Œæ¯ä¸ªæ–‡ä»¶éƒ½ç”¨äº†`class`è¿™ä¸ªè¯­æ³•ç³–ã€‚

```javascript
// babel.config.js é…ç½®æ–‡ä»¶
const presets = [
    '@babel/preset-env'
];
module.exports = {presets};

// Animal.js æ–‡ä»¶
export default class Animal {
    constructor() {}
};

// Country.js æ–‡ä»¶
export default class Country {
    constructor() {}
};

// index.js æ–‡ä»¶
import Animal from "./class/Animal";
import Country from "./class/Country";

class People {
    constructor() {
    }
};

const lMC = new People();
const cat = new Animal();
const usa = new Country();
```

æœ€åæ‰“åŒ…å‡ºæ¥æ–‡ä»¶ï¼š

![big-dist-size.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f35c1d468ee84557a6895cb7a4b4f732~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp?)

çœ‹çœ‹çº¢è‰²çš„æ¡†æ¡†ï¼Œæˆ‘ä»¬ä¼šå‘ç°å®ç°çš„æ–¹æ³•éƒ½æ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥åœ¨æ¯ä¸ªä½¿ç”¨åˆ°`class`è¯­æ³•ç³–çš„æ–‡ä»¶ä¸­ï¼Œè¾…åŠ©å‡½æ•°éƒ½è¢«ç”Ÿæˆå¹¶æ’å…¥äº†ä¸€æ¬¡ï¼Œè¿™äº›åŸºæœ¬é‡å¤çš„ä»£ç ï¼Œæ— ç–‘æ˜¯ä¼šå¤§å¤§å¢åŠ æˆ‘ä»¬çš„æ‰“åŒ…ä½“ç§¯çš„ã€‚ç›®å‰æ‰“åŒ…å‡ºæ¥çš„ä½“ç§¯æ˜¯ï¼š`6KB`ã€‚

ä¸ºäº†è§£å†³ä¸Šè¿°çš„å¼Šç«¯ï¼Œæˆ‘ä»¬å°±å¾—ä½¿ç”¨`@babel/plugin-transform-runtime`æ’ä»¶ã€‚ä»`@babel/runtime`æ¨¡å—æˆ‘ä»¬çŸ¥é“ï¼Œå®ƒé‡Œé¢å­˜æ”¾äº†`Babel`è¾…åŠ©å‡½æ•°çš„é›†åˆï¼Œ`@babel/plugin-transform-runtime`ä¼šå°†æˆ‘ä»¬ç”¨åˆ°çš„è¾…åŠ©å‡½æ•°ï¼Œä»`@babel/runtime`ä¸­ä»¥`require`æˆ–è€…`import`çš„æ–¹å¼ï¼Œå¼•å…¥åˆ°æˆ‘ä»¬çš„æ–‡ä»¶ä¸­ï¼Œå®ç°å¤ç”¨ï¼Œä»è€Œå‡å°æˆ‘ä»¬æœ€ç»ˆè¾“å‡ºåŒ…çš„ä½“ç§¯ã€‚

æ‰€ä»¥`@babel/runtime`è·Ÿ`@babel/plugin-transform-runtime`ä¸¤è€…é€šå¸¸æ˜¯é…åˆä¸€èµ·ä½¿ç”¨ã€‚

> å¤‡æ³¨ï¼šå…³äº`@babel/plugin-transform-runtime`é…ç½®åŠŸèƒ½ï¼Œå¯æŸ¥çœ‹è¿™ç¯‡â€”â€”[Babel é…ç½®ä¸è¦å†â€œå¤åˆ¶ç²˜è´´â€äº†ï¼Œå¸¦ä½ è‡ªå·±é…ä¸€ä¸ª Babel](https://juejin.cn/post/7197666704435920957)

æˆ‘ä»¬ç”¨è¿™ä¸ªæ¡ˆä¾‹ [use-transform-runtime](https://github.com/limingcan562/learn-babel-7/tree/main/use-transform-runtime) çœ‹çœ‹ä½¿ç”¨äº†`@babel/plugin-transform-runtime`æ’ä»¶ä»¥åæœ‰ä»€ä¹ˆå˜åŒ–ã€‚

æˆ‘ä»¬çš„æ¡ˆä¾‹ä»£ç è·Ÿä¸Šè¿°ä¸€æ ·ï¼Œåªæ˜¯åœ¨`babel.config.js`å¢åŠ äº†`@babel/plugin-transform-runtime`é…ç½®

```javascript
// babel.config.js é…ç½®æ–‡ä»¶
// å¢åŠ äº†@babel/plugin-transform-runtime é…ç½®
const plugins = [
    '@babel/plugin-transform-runtime'
]
const presets = [
    '@babel/preset-env'
];
module.exports = {plugins, presets};

// Animal.js æ–‡ä»¶
export default class Animal {
    constructor() {}
};

// Country.js æ–‡ä»¶
export default class Country {
    constructor() {}
};

// index.js æ–‡ä»¶
import Animal from "./class/Animal";
import Country from "./class/Country";

class People {
    constructor() {
    }
};

const lMC = new People();
const cat = new Animal();
const usa = new Country();
```

ç¼–è¯‘è·Ÿæ‰“åŒ…åçš„æ–‡ä»¶ï¼š

![use-transform-runtime.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ff76fa6895784f87956e14d9026c53ed~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp?)

æˆ‘ä»¬ä¼šå‘ç°ï¼š

- è¾…åŠ©å‡½æ•°ä¼šä»¥`require`å¼•ç”¨çš„æ–¹å¼åŠ åˆ°æˆ‘ä»¬çš„ä»£ç ä¸­
- æ‰“åŒ…åï¼Œè¾…åŠ©å‡½æ•°åªç”¨äº†ä¸€æ¬¡ï¼Œè€Œä¸”ä¸æ˜¯æ’å…¥ä¸‰æ¬¡ï¼Œå¾ˆå¥½çš„å®ç°äº†å¤ç”¨
- æ‰“åŒ…å‡ºæ¥çš„ä½“ç§¯ä¹Ÿå˜æˆäº†`3KB`ï¼Œå¾ˆå¥½çš„ç¼©å°äº†æœ€ååŒ…çš„ä½“ç§¯ï¼ˆä¸è¦å°çœ‹ç¼©å°äº†`3KB`ï¼Œåªæ˜¯å› ä¸ºæˆ‘ç”¨æœ€ç®€å•çš„æ–¹å¼å†™äº†`ES6+`è¯­æ³•ï¼Œå®é™…ä¸­æˆ‘ä»¬é¡¹ç›®è‚¯å®šæ²¡é‚£ä¹ˆç®€å•ï¼‰

æ‰€ä»¥`@babel/runtime`è·Ÿ`@babel/plugin-transform-runtime`ä¸¤è€…é…åˆä¸€èµ·ä½¿ç”¨ï¼Œä¸€èˆ¬æ¥è¯´æ˜¯å¯ä»¥å¸®åŠ©æˆ‘ä»¬å¤§å¤§å‡å°‘æ‰“åŒ…åçš„ä½“ç§¯çš„ã€‚

## æœ€å

å¦‚æœè¯»å®Œè¿™ç¯‡æ–‡ç« ï¼Œä½ å¯¹`Babel`çš„ä¸»è¦å‡ ä¸ªåŒ…å·²ç»æœ‰äº†æ›´æ¸…æ™°çš„è®¤è¯†ï¼Œé‚£å·²ç»å¯ä»¥æ›´å¥½çš„æ·±å…¥`Babel`é…ç½®äº†ã€‚ å¦‚æœä½ æƒ³æ›´å¥½åœ°å­¦ä¹ `Babel`çš„é…ç½®ï¼Œå¯ä»¥é˜…è¯»è¿™ç¯‡æ–‡ç« â€”â€”[Babel é…ç½®ä¸è¦å†â€œå¤åˆ¶ç²˜è´´â€äº†ï¼Œå¸¦ä½ è‡ªå·±é…ä¸€ä¸ª Babel](https://juejin.cn/post/7197666704435920957)

ç« èŠ‚ä¸­çš„æ¡ˆä¾‹ï¼Œä»£ç éƒ½æ”¾åˆ° [Github](https://github.com/limingcan562/learn-babel-7) ä¸Šäº†ï¼Œ

æ–‡ç« ä¸­æœ‰ç”¨åˆ°`Webpack`ï¼Œå¦‚æœä½ ä¹Ÿæƒ³äº†è§£`Webpack`çš„çŸ¥è¯†ï¼Œå¯ä»¥çœ‹çœ‹æˆ‘è‡ªå·±ç”¨`Webpack5`æ­çš„è„šæ‰‹æ¶ [webpack5-boilerplate](https://github.com/limingcan562/webpack5-boilerplate)ï¼Œè·Ÿä¹‹å‰æˆ‘å†™çš„è¿™ç¯‡æ–‡ç« â€”â€” [webpack5 ä¼˜åŒ–çš„åœ°æ–¹åŠæ­å»ºçš„ä¸€äº›ä½“ä¼š](https://juejin.cn/post/7077189347941974024)ã€‚
