---
title: "åŸºäº requestAnimationFrame å®ç°é«˜ç²¾åº¦æ¯«ç§’çº§æ­£å‘è®¡æ—¶å™¨"
date: 2023-01-14T09:30:08+08:00
---

## éœ€æ±‚åˆ†æ

ä»å›¾ä¸Šå¯ä»¥çœ‹å‡ºæ¥ï¼Œæ ¸å¿ƒå°±æ˜¯ä¸€ä¸ªæ­£å‘è®¡æ—¶å™¨ã€‚é€šè¿‡ js å®ç°ä¸€ä¸ªæ™®é€šçš„æ­£å‘è®¡æ—¶å™¨å¾ˆç®€å•ï¼Œå¤§å¤šæ•°æƒ³åˆ°éƒ½æ˜¯ä½¿ç”¨`setInterval`æ¥å®ç°ã€‚é‚£ä¹ˆè¿˜æœ‰æ²¡æœ‰å…¶ä»–çš„å®ç°æ–¹å¼å‘¢ï¼Ÿåˆæ€ä¹ˆå»å®ç°ä¸€ä¸ªé«˜ç²¾åº¦çš„æ¯«ç§’çº§æ­£å‘è®¡æ—¶å™¨å‘¢ï¼Ÿ

æœ€è¿‘çœ‹äº† vant4 çš„å€’è®¡æ—¶ç»„ä»¶çš„æºç ï¼Œå‘ç°å…¶å¹¶æ²¡æœ‰ä½¿ç”¨`setInterval`, è€Œæ˜¯å°è£…äº†`requestAnimationFrame` å’Œåˆ©ç”¨ `Date.now()`æ¥å¤„ç†æ¯«ç§’çº§æ¸²æŸ“å’Œå€’è®¡æ—¶å®ç°ã€‚é‚£ä¹ˆèƒ½ä¸èƒ½é€šè¿‡`requestAnimationFrame`æ¥å®ç°ä¸€ä¸ªæ­£å‘è®¡æ—¶å™¨å‘¢ï¼Ÿ

å…ˆçœ‹çœ‹æ•ˆæœå›¾ï¼Œæ¥ä¸‹æ¥å°†ä¼šä¸€æ­¥æ­¥å»å®ç°ï¼š

![è®¡æ—¶å™¨](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/45e5bd0b6aac448fbe9fa6c4e835b33c~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp)

ä½“éªŒåœ°å€ï¼š [suyxh.github.io/timer-demo/](https://link.juejin.cn/?target=https%3A%2F%2Fsuyxh.github.io%2Ftimer-demo%2F "https://suyxh.github.io/timer-demo/")

## setInterval ç‰ˆ

é¦–å…ˆå‘¢ï¼Œæ¥çœ‹çœ‹ä½¿ç”¨`setInterval`æ˜¯å¦‚ä½•å®ç°çš„ã€‚åœ¨ç½‘ä¸Šçœ‹äº†å¾ˆå¤šæ–‡ç« ï¼Œå¤§å¤šéƒ½æ˜¯ä½¿ç”¨çš„ `setInterval` å»å®ç°ï¼Œå¤§è‡´æ•ˆæœå¦‚ä¸‹ï¼š

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4985044b778b47ae9b03dd26570c3106~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp)

ä»æ•ˆæœå›¾ä¸Šæˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œæœ€åä¸€ä½å§‹ç»ˆä¸º 0ï¼Œç”šè‡³è¿˜æ˜¯æœ‰äº›å° bugï¼Œå¾ˆæ˜æ˜¾ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ã€‚å…·ä½“ä»£ç å¦‚ä¸‹ï¼š

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>

  <body>
    <input type="text" id="timetext" value="00æ—¶00åˆ†00ç§’" readonly />
    <br />
    <br />
    <button type="button" onclick="start()">å¼€å§‹</button>
    <button type="button" onclick="stop()">æš‚åœ</button>
    <button type="button" onclick="Reset()">é‡ç½®</button>

    <script>
      //åˆå§‹åŒ–å˜é‡
      let hour, minute, second; //æ—¶ åˆ† ç§’
      hour = minute = second = 0; //åˆå§‹åŒ–
      let millisecond = 0; //æ¯«ç§’
      let int;
      //é‡ç½®å‡½æ•°
      function Reset() {
        window.clearInterval(int);
        millisecond = hour = minute = second = 0;
        document.getElementById("timetext").value = "00æ—¶00åˆ†00ç§’000æ¯«ç§’";
      }
      //å¼€å§‹å‡½æ•°
      function start() {
        int = setInterval(timer, 50); //æ¯éš”50æ¯«ç§’æ‰§è¡Œä¸€æ¬¡timerå‡½æ•°
      }
      //è®¡æ—¶å‡½æ•°
      function timer() {
        millisecond = millisecond + 50;
        if (millisecond >= 1000) {
          millisecond = 0;
          second = second + 1;
        }
        if (second >= 60) {
          second = 0;
          minute = minute + 1;
        }

        if (minute >= 60) {
          minute = 0;
          hour = hour + 1;
        }
        document.getElementById("timetext").value =
          hour + "æ—¶" + minute + "åˆ†" + second + "ç§’" + millisecond + "æ¯«ç§’";
      }
      //æš‚åœå‡½æ•°
      function stop() {
        window.clearInterval(int);
      }
    </script>
  </body>
</html>
```

## requestAnimationFrame ç‰ˆ

ä¸Šæ–‡ä¸­æåˆ° vant çš„ CutDown ç»„ä»¶ï¼Œä¸»è¦å°±æ˜¯åˆ©ç”¨ `Date.now()` ä¼šè‡ªå·±èµ°çš„åŸç†ï¼Œç»“åˆ `requestAnimationFrame` å»åšæ—¶é—´è®¡ç®—ï¼›é‚£ä¹ˆæ­£å‘è®¡æ—¶å™¨åˆ™æ˜¯åˆ©ç”¨äº† `requestAnimationFrame` å›è°ƒå‡½æ•°çš„å‚æ•°å»åšæ—¶é—´è®¡ç®—ï¼Œä»è€Œå®ç°æ¯«ç§’çº§çš„è®¡æ—¶å™¨ã€‚

**`window.requestAnimationFrame()`** å‘Šè¯‰æµè§ˆå™¨â€”â€”ä½ å¸Œæœ›æ‰§è¡Œä¸€ä¸ªåŠ¨ç”»ï¼Œå¹¶ä¸”è¦æ±‚æµè§ˆå™¨åœ¨ä¸‹æ¬¡é‡ç»˜ä¹‹å‰è°ƒç”¨æŒ‡å®šçš„å›è°ƒå‡½æ•°æ›´æ–°åŠ¨ç”»ã€‚è¯¥æ–¹æ³•éœ€è¦ä¼ å…¥ä¸€ä¸ªå›è°ƒå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œè¯¥å›è°ƒå‡½æ•°ä¼šåœ¨æµè§ˆå™¨ä¸‹ä¸€æ¬¡é‡ç»˜ä¹‹å‰æ‰§è¡Œï¼Œå½“ä½ å‡†å¤‡æ›´æ–°åŠ¨ç”»æ—¶ä½ åº”è¯¥è°ƒç”¨æ­¤æ–¹æ³•ã€‚è¿™å°†ä½¿æµè§ˆå™¨åœ¨ä¸‹ä¸€æ¬¡é‡ç»˜ä¹‹å‰è°ƒç”¨ä½ ä¼ å…¥ç»™è¯¥æ–¹æ³•çš„åŠ¨ç”»å‡½æ•° (å³ä½ çš„å›è°ƒå‡½æ•°)ã€‚

> **æ³¨æ„ï¼š** è‹¥ä½ æƒ³åœ¨æµè§ˆå™¨ä¸‹æ¬¡é‡ç»˜ä¹‹å‰ç»§ç»­æ›´æ–°ä¸‹ä¸€å¸§åŠ¨ç”»ï¼Œé‚£ä¹ˆå›è°ƒå‡½æ•°è‡ªèº«å¿…é¡»å†æ¬¡è°ƒç”¨ `window.requestAnimationFrame()`

MDN [requestAnimationFrame](https://link.juejin.cn/?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FAPI%2FWindow%2FrequestAnimationFrame "https://developer.mozilla.org/zh-CN/docs/Web/API/Window/requestAnimationFrame")

**å‚æ•°**

- `callback`
  ä¸‹ä¸€æ¬¡é‡ç»˜ä¹‹å‰æ›´æ–°åŠ¨ç”»å¸§æ‰€è°ƒç”¨çš„å‡½æ•° (å³ä¸Šé¢æ‰€è¯´çš„å›è°ƒå‡½æ•°)ã€‚è¯¥å›è°ƒå‡½æ•°ä¼šè¢«ä¼ å…¥[`DOMHighResTimeStamp`](https://link.juejin.cn/?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FAPI%2FDOMHighResTimeStamp "https://developer.mozilla.org/zh-CN/docs/Web/API/DOMHighResTimeStamp")å‚æ•°ï¼Œè¯¥å‚æ•°ä¸[`performance.now()`](https://link.juejin.cn/?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FAPI%2FPerformance%2Fnow "https://developer.mozilla.org/zh-CN/docs/Web/API/Performance/now")çš„è¿”å›å€¼ç›¸åŒï¼Œå®ƒè¡¨ç¤º`requestAnimationFrame()` å¼€å§‹å»æ‰§è¡Œå›è°ƒå‡½æ•°çš„æ—¶åˆ»ã€‚

**è¿”å›å€¼**

ä¸€ä¸ª `long` æ•´æ•°ï¼Œè¯·æ±‚ IDï¼Œæ˜¯å›è°ƒåˆ—è¡¨ä¸­å”¯ä¸€çš„æ ‡è¯†ã€‚æ˜¯ä¸ªéé›¶å€¼ï¼Œæ²¡åˆ«çš„æ„ä¹‰ã€‚ä½ å¯ä»¥ä¼ è¿™ä¸ªå€¼ç»™ [`window.cancelAnimationFrame()`](https://link.juejin.cn/?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FAPI%2FWindow%2FcancelAnimationFrame "https://developer.mozilla.org/zh-CN/docs/Web/API/Window/cancelAnimationFrame") ä»¥å–æ¶ˆå›è°ƒå‡½æ•°ã€‚

### æµ‹è¯•ç‰ˆ

é€šè¿‡ `requestAnimationFrame` API å¯ä»¥çŸ¥é“ï¼Œå›è°ƒå‡½æ•°ä¸­çš„å‚æ•°å°±æ˜¯ä¸€ä¸ª [`DOMHighResTimeStamp`](https://link.juejin.cn/?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FAPI%2FDOMHighResTimeStamp "https://developer.mozilla.org/zh-CN/docs/Web/API/DOMHighResTimeStamp")å‚æ•°ï¼Œè¯¥å‚æ•°ä¸[`performance.now()`](https://link.juejin.cn/?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FAPI%2FPerformance%2Fnow "https://developer.mozilla.org/zh-CN/docs/Web/API/Performance/now")çš„è¿”å›å€¼ç›¸åŒï¼Œå®ƒè¡¨ç¤º`requestAnimationFrame()` å¼€å§‹å»æ‰§è¡Œå›è°ƒå‡½æ•°çš„æ—¶åˆ»ã€‚

é‚£æˆ‘ä»¬ç›´æ¥ä½¿ç”¨è¯¥å€¼ä¸å°±å¯ä»¥äº†å—ï¼Ÿè¯•è¯•çœ‹ï¼š

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>

  <body>
    <div id="app">hello world</div>
    <div id="status">è¿™é‡Œæ˜¾ç¤ºå€’è®¡æ—¶çŠ¶æ€</div>
    <button class="start">å¼€å§‹</button>

    <br />

    <script>
      const render = (time) => {
        document.querySelector("#status").innerHTML = Math.floor(time) / 1000;
      };

      const useCountUp = () => {
        let rafId;
        let endTime;

        const step = (timestamp) => {
          console.log("timestamp", timestamp);
          render(timestamp);
          rafId = window.requestAnimationFrame(step);
        };

        const start = () => {
          rafId = window.requestAnimationFrame(step);
        };

        return {
          start,
        };
      };

      const { start } = useCountUp();

      document.querySelector(".start").addEventListener("click", () => {
        start();
      });
    </script>
  </body>
</html>
```

æ•ˆæœå¦‚ä¸‹ï¼š

![æµ‹è¯•ç‰ˆ](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/415a8918c78f4d9286aef86fd9c43031~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp)

è™½ç„¶æ¯”è¾ƒç®€é™‹ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰å‡ºç° `setIntervalç‰ˆ` çš„ bugï¼Œæ¥ä¸‹æ¥åœ¨ä¸€æ­¥æ­¥ä¼˜åŒ–ã€‚

### ç®€æ˜“ç‰ˆ

æˆ‘ä»¬åŠ ä¸Šæ ¼å¼åŒ–æ—¶é—´çš„å‡½æ•° `parseTime()` å’Œ `parseFormat()`ï¼Œ ä»£ç å¦‚ä¸‹ï¼š

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>

  <body>
    <div id="app">hello world</div>
    <div id="status">è¿™é‡Œæ˜¾ç¤ºå€’è®¡æ—¶çŠ¶æ€</div>
    <button class="start">å¼€å§‹</button>

    <br />

    <script>
      /**
       * @description: è¡¥0æ“ä½œ
       * @param {*} num
       * @param {*} targetLength
       * @return {*}
       */
      function padZero(num, targetLength = 2) {
        let str = num + "";

        while (str.length < targetLength) {
          str = "0" + str;
        }

        return str;
      }

      /**
       * @description: è§£ææ—¶é—´
       * @param {*} time
       * @return {*}
       */
      function parseTime(time) {
        const SECOND = 1000;
        const MINUTE = 60 * SECOND;
        const HOUR = 60 * MINUTE;
        const DAY = 24 * HOUR;

        const days = Math.floor(time / DAY);
        const hours = Math.floor((time % DAY) / HOUR);
        const minutes = Math.floor((time % HOUR) / MINUTE);
        const seconds = Math.floor((time % MINUTE) / SECOND);
        const milliseconds = Math.floor(time % SECOND);

        return {
          total: time,
          days,
          hours,
          minutes,
          seconds,
          milliseconds,
        };
      }

      /**
       * @description: æ ¼å¼åŒ–æ—¶é—´
       * @param {*} format
       * @param {*} currentTime
       * @return {*}
       */
      function parseFormat(format, currentTime) {
        const { days } = currentTime;
        let { hours, minutes, seconds, milliseconds } = currentTime;

        if (format.includes("DD")) {
          format = format.replace("DD", padZero(days));
        } else {
          hours += days * 24;
        }

        if (format.includes("HH")) {
          format = format.replace("HH", padZero(hours));
        } else {
          minutes += hours * 60;
        }

        if (format.includes("mm")) {
          format = format.replace("mm", padZero(minutes));
        } else {
          seconds += minutes * 60;
        }

        if (format.includes("ss")) {
          format = format.replace("ss", padZero(seconds));
        } else {
          milliseconds += seconds * 1000;
        }

        if (format.includes("S")) {
          const ms = padZero(milliseconds, 3);

          if (format.includes("SSS")) {
            format = format.replace("SSS", ms);
          } else if (format.includes("SS")) {
            format = format.replace("SS", ms.slice(0, 2));
          } else {
            format = format.replace("S", ms.charAt(0));
          }
        }

        return format;
      }

      /**
       * @description: æ¸²æŸ“æ—¶é—´
       * @param {*} time
       * @return {*}
       */
      const render = (time) => {
        time = parseFormat("HH:mm:ss:SSS", parseTime(time));
        document.querySelector("#status").innerHTML = time;
      };

      const useCountUp = () => {
        let rafId;
        let endTime;

        const step = (timestamp) => {
          console.log("timestamp", timestamp);
          // render(timestamp)
          rafId = window.requestAnimationFrame(step);
        };

        const start = () => {
          rafId = window.requestAnimationFrame(step);
        };

        return {
          start,
        };
      };

      const { start } = useCountUp();

      document.querySelector(".start").addEventListener("click", () => {
        start();
      });
    </script>
  </body>
</html>
```

æ•ˆæœå¦‚ä¸‹ï¼š

![ç®€æ˜“ç‰ˆ](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b3b367f5cc4341d5a820f70fdcd5638b~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp)

åˆçœ‹åˆ°äº†æˆ‘ä»¬ç†Ÿæ‚‰çš„æ—¶é—´æ ¼å¼å•¦ï¼Œ æ ¼å¼åŒ–çš„æ–¹æ³•ä¹Ÿæ˜¯æ¥æºäº vant çš„ CutDown ç»„ä»¶ä¸­çš„æ ¼å¼åŒ–ä»£ç ï¼

æ ¼å¼åŒ–è™½ç„¶æ˜¯å®Œæˆäº†ï¼Œä½†æ˜¯æ€ä¹ˆå»åœæ­¢å‘¢ï¼Ÿèƒ½ä¸èƒ½æ”¯æŒæš‚åœã€ç»§ç»­ã€é‡ç½®å‘¢ï¼Ÿ

æ¥ä¸‹æ¥ç»§ç»­å®Œå–„ã€‚

### è¿›é˜¶ç‰ˆ

æˆ‘ä»¬ç›´æ¥é€šè¿‡ [`window.cancelAnimationFrame()`](https://link.juejin.cn/?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FAPI%2FWindow%2FcancelAnimationFrame "https://developer.mozilla.org/zh-CN/docs/Web/API/Window/cancelAnimationFrame") å»å–æ¶ˆå›è°ƒå‡½æ•°å³å¯ï¼åœ¨ `useCountUp`å‡½æ•°ä¸­æ·»åŠ ä¸€ä¸‹ `pause` å³å¯ï¼

```js
const pause = () => {
  if (rafId) {
    window.cancelAnimationFrame(rafId);
  }
};
```

æ•ˆæœå¦‚ä¸‹ï¼š

![è¿›é˜¶ç‰ˆ-åœæ­¢Bugç‰ˆ_1](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a4db669480734759bd881ba60ac930b3~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp)

ä¸å°‘çš„å°ä¼™ä¼´å·²ç»å‘ç°ï¼Œåœæ­¢è™½ç„¶æ˜¯æ²¡é—®é¢˜äº†ï¼Œå½“å†æ¬¡ç‚¹å‡»å¼€å§‹çš„æ—¶å€™ï¼Œæ—¶é—´æ€ä¹ˆä¸å¯¹äº†ï¼Ÿæœ‰ç‘•ç–µï¼

å› ä¸ºæˆ‘ä»¬å°‘ç®—è¡¥æ—¶æ—¶é—´ï¼Œåšå¦‚ä¸‹ä¿®æ”¹ï¼Œæ·»åŠ `startTime` ã€ `stopTime` å’Œ `goOn` æ–¹æ³•:

```js
const useCountUp = () => {
  let rafId;
  let startTime;
  let stopTime;

  const step = (timestamp) => {
    console.log("timestamp", timestamp);
    render(timestamp - startTime);
    rafId = window.requestAnimationFrame(step);
  };

  const start = () => {
    startTime = performance.now();
    rafId = window.requestAnimationFrame(step);
  };

  const pause = () => {
    stopTime = performance.now();
    if (rafId) {
      window.cancelAnimationFrame(rafId);
    }
  };

  const goOn = () => {
    startTime += performance.now() - stopTime;
    rafId = window.requestAnimationFrame(step);
  };

  return {
    start,
    pause,
    goOn,
  };
};
```

è¿™é‡ŒåŸºæœ¬ä¸Šå·²ç»å®Œæˆäº†æš‚åœå’Œç»§ç»­çš„åŠŸèƒ½äº†ï¼Œä½†æ˜¯ä»æ˜¯æœ‰äº› bug çš„ï¼Œå¯ä»¥å¤šæ¬¡ç‚¹å‡»ç»§ç»­è¯•è¯• ğŸ™ˆ ã€‚

### å®Œæ•´ç‰ˆ

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥ä¿®å¤ä¸Šè¿°çš„ bugï¼Œæ–¹æ³•ï¼šæ·»åŠ ä¸€ä¸ªå˜é‡æ¥è¡¨ç¤ºå½“å‰è®¡æ—¶å™¨çš„çŠ¶æ€ã€‚

åœ¨å¢åŠ å‡ ä¸ªæ–°åŠŸèƒ½ï¼š

- æ·»åŠ  é‡ç½® æ–¹æ³•ï¼š å…¶å®æˆ‘ä»¬åªéœ€è¦è°ƒç”¨ä¸€ä¸‹æš‚åœï¼Œåœ¨æ¸…ç†ä¸€ä¸‹æ—¶é—´å³å¯
- æ”¯æŒ é…ç½®ï¼šæ¯”å¦‚ æ­£é¦™è®¡æ—¶çš„æ—¶é—´ï¼Œ è®¡æ—¶ç»“æŸçš„å‡½æ•°

æ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼Œå…¶ä»–éƒ¨åˆ†ä»£ç ä¸å˜ï¼š

```js
const useCountUp = (options) => {
  let rafId,
    startTime,
    stopTime,
    curentTime,
    counting = false;

  const step = (timestamp) => {
    curentTime = timestamp - startTime;
    render(curentTime);
    options.onChange?.(curentTime);

    if (options.time) {
      if (Math.floor(curentTime) < options.time) {
        rafId = window.requestAnimationFrame(step);
      } else {
        pause();
        options.onFinish?.();
      }
    } else {
      rafId = window.requestAnimationFrame(step);
    }
  };

  const start = () => {
    // è®¡æ—¶ä¸­ æˆ–è€… å·²ç»å¼€å§‹è¿‡è®¡æ—¶æƒ³è¦é‡æ–°å¼€å§‹è®¡æ—¶ï¼Œåº”è¯¥å…ˆç‚¹å‡»ä¸€ä¸‹ é‡ç½® å†å¼€å§‹è®¡æ—¶
    if (counting || curentTime) {
      return;
    }
    counting = true;
    startTime = performance.now();
    rafId = window.requestAnimationFrame(step);
  };

  const pause = () => {
    // å·²ç»æš‚åœåï¼Œå±è”½æ‰ç‚¹å‡»
    if (!counting) {
      return;
    }
    counting = false;
    stopTime = performance.now();
    if (rafId) {
      window.cancelAnimationFrame(rafId);
    }
  };

  const goOn = () => {
    // å·²ç»åœ¨è®¡æ—¶ä¸­ï¼Œå±è”½æ‰ç‚¹å‡»
    if (counting) {
      return;
    }
    counting = true;
    startTime += performance.now() - stopTime;
    rafId = window.requestAnimationFrame(step);
  };

  const reset = () => {
    pause();
    curentTime = 0;
    startTime = 0;
    stopTime = 0;
    render(0);
  };

  return {
    start,
    pause,
    goOn,
    reset,
  };
};

const { start, pause, goOn, reset } = useCountUp({
  time: 3 * 1000,
  onChange: (current) => console.log("change", current),
  onFinish: () => console.log("finish"),
});

document.querySelector(".start").addEventListener("click", () => {
  start();
});

document.querySelector(".pause").addEventListener("click", () => {
  pause();
});

document.querySelector(".goOn").addEventListener("click", () => {
  goOn();
});

document.querySelector(".reset").addEventListener("click", () => {
  reset();
});
```

åˆ°æ­¤åŸºæœ¬ä¸Šå°±æ˜¯å®ç°äº†ä¸€ä¸ªæ¯«ç§’çº§çš„æ­£å‘è®¡æ—¶å™¨ï¼

### vue ç‰ˆ

> åªæ˜¯å¯¹ js çš„é€»è¾‘è¿›è¡Œäº†ä¸€äº›å°è£…

ä»£ç ï¼š[github.com/SuYxh/timerâ€¦](https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2FSuYxh%2Ftimer-demo "https://github.com/SuYxh/timer-demo")

é¢„è§ˆï¼š[suyxh.github.io/timer-demo/](https://link.juejin.cn/?target=https%3A%2F%2Fsuyxh.github.io%2Ftimer-demo%2F "https://suyxh.github.io/timer-demo/")

## æ€»ç»“

æ­£å‘æ¯«ç§’çº§è®¡æ—¶å™¨ä¸»è¦å°±æ˜¯åˆ©ç”¨äº†`window.requestAnimationFrame`çš„å›è°ƒå‡½æ•°çš„å‚æ•°ä¸º[`DOMHighResTimeStamp`](https://link.juejin.cn/?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FAPI%2FDOMHighResTimeStamp "https://developer.mozilla.org/zh-CN/docs/Web/API/DOMHighResTimeStamp")ï¼Œä¸”ä¸[`performance.now()`](https://link.juejin.cn/?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FAPI%2FPerformance%2Fnow "https://developer.mozilla.org/zh-CN/docs/Web/API/Performance/now")çš„è¿”å›å€¼ç›¸åŒï¼›åœ¨å®ç°æš‚åœã€ç»§ç»­æ—¶ï¼Œéœ€è¦è®¡ç®—ä¸€ä¸‹è¡¥æ—¶æ—¶é—´ã€‚
