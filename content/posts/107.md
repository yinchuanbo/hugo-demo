---
title: "webRTC 获取指定输入设备的音视频流"
date: 2022-09-24T20:28:57+08:00
draft: false
tags: ['webRTC', '音视频']
---

> 获取指定输入设备的音视频数据，就是在 getUserMedia 的 constraints 加上 deviceId 的限制，实例代码如下。

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- start -->
    <div>
        <label>音频输入设备</label>
        <select name="" id="audio_input"></select>
    </div>

    <div>
        <label>视频输入设备</label>
        <select name="" id="video_input"></select>
    </div>

    <video autoplay playsinline id="video_player"></video>
    <!-- end -->
    <script src="https://webrtc.github.io/adapter/adapter-latest.js"></script>
    <script src="script.js"></script>
</body>
</html>
```

```js
"use strict";

var audioInput = document.getElementById("audio_input");
var videoInput = document.getElementById("video_input");
var videoPlayer = document.getElementById("video_player");

function GetMediaStream(mediaStream) {
  videoPlayer.srcObject = mediaStream;
  return navigator.mediaDevices.enumerateDevices();
}

function GetDevices(deviceInfos) {
  console.log("list", deviceInfos);
  audioInput.innerHTML = "";
  videoInput.innerHTML = "";
  deviceInfos.forEach((deviceInfo) => {
    var option = document.createElement("option");
    option.text = deviceInfo.label;
    option.value = deviceInfo.deviceId;
    if (deviceInfo.kind === "audioinput") {
      audioInput.appendChild(option);
    } else if (deviceInfo.kind === "videoinput") {
      videoInput.appendChild(option);
    } else {
      console.log("unknown device kind");
    }
  });
}

function HandleError(err) {
  console.log(err.name + "," + err.message);
}

function Start() {
  if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
    console.log("getUserMedia is not supported!");
  } else {
    var audioDeviceId = audioInput.value;
    var videoDeviceId = videoInput.value;
    var constraints = {
      video: {
        frameRate: {
          min: 20,
        },
        width: {
          min: 640,
          ideal: 640,
        },
        height: {
          min: 360,
          ideal: 480,
        },
        aspectRatio: 16 / 9,
        deviceId: videoDeviceId ? videoDeviceId : undefined,
      },
      audio: {
        echoCancellation: true, // 回声消除
        noiseSuppression: true, // 降噪
        autoGainControl: true, // 自动增益
        deviceId: audioDeviceId,
      },
    };
    navigator.mediaDevices
      .getUserMedia(constraints)
      .then(GetMediaStream)
      .then(GetDevices)
      .catch(HandleError);
  }
}

Start();

audioInput.onchange = Start;
videoInput.onchange = Start;
```

<img src="/imgs/notes/2022-09-24T12-30-51.167Z.png" />