---
title: "Pinia"
date: 2022-10-17T22:36:55+08:00
---

## 1.ä¸ºä»€ä¹ˆéœ€è¦ pinia

- Pinia æœ€åˆåªæ˜¯ä¸ºäº†åˆæ¢ Vuex çš„ä¸‹ä¸€æ¬¡è¿­ä»£æ˜¯ä»€ä¹ˆæ ·å­,ç»“åˆäº† Vuex5 æ ¸å¿ƒå›¢é˜Ÿè®¨è®ºä¸­çš„è®¸å¤šæƒ³æ³•
- æœ€ç»ˆï¼Œå›¢é˜Ÿæ„è¯†åˆ° Pinia å·²ç»å®ç°äº† Vuex5 ä¸­å¤§éƒ¨åˆ†å†…å®¹ï¼Œæ‰€ä»¥æœ€ç»ˆå†³å®šç”¨ Pinia æ¥æ›¿ä»£ Vuex;
- ä¸ Vuex ç›¸æ¯”ï¼ŒPinia æä¾›äº†ä¸€ä¸ªæ›´ç®€å•çš„ APIï¼Œå…·æœ‰æ›´å°‘çš„ä»ªå¼ï¼Œæä¾›äº† Composition-API é£æ ¼çš„ API;
- æœ€é‡è¦çš„æ˜¯ï¼Œåœ¨ä¸ TypeScript ä¸€èµ·ä½¿ç”¨æ—¶å…·æœ‰å¯é çš„ç±»å‹æ¨æ–­æ”¯æŒ;
- å’Œ Vuex ç›¸æ¯”,Pinia æœ‰è®¸å¤šä¼˜åŠ¿:
  - mutations ä¸å†å­˜åœ¨,å› ä¸º mutations é€šå¸¸è¢«è®¤ä¸ºæ˜¯éå¸¸å†—é•¿
  - æ›´å‹å¥½çš„ Typescript æ”¯æŒ,Vuex å¯¹ TS æ”¯æŒå¹¶ä¸å‹å¥½
  - ä¸å†æœ‰ modules çš„åµŒå¥—ç»“æ„:
    - å¯ä»¥çµæ´»ä½¿ç”¨æ¯ä¸€ä¸ª store,å®ƒä»¬æ˜¯é€šè¿‡æ‰å¹³åŒ–çš„æ–¹å¼æ¥ç›¸äº’ä½¿ç”¨

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2544ccb1f5d748fb9a0628e53a88aea4~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp)

---

## 2.å¦‚ä½•ä½¿ç”¨ Pinia

> ä»¥ä¸‹æ­¥éª¤éƒ½æ˜¯ä»¥è„šæ‰‹æ¶å½¢å¼å¼€å‘çš„,æ‰€ä»¥å­¦ä¹  pinia ä¹‹å‰è¯·ä¸‹è½½ä¸ªè„šæ‰‹æ¶ç”Ÿæˆé¡¹ç›®

- 2.1:ç¬¬ä¸€æ­¥å½“ç„¶æ˜¯ä¸‹è½½ Pinia è¾£
- 2.2:åˆ›å»º stores/index.js ä½œä¸ºå…¥å£æ–‡ä»¶
- 2.3:å»åˆ° main.js ä¸­å¯¼å…¥
- 2.4:åˆ›å»º counter.js

```shell
yarn add pinia
#or with npm
npm install pinia
```

```javascript
//stores/index.js
import { createPinia } from "pinia";
const pinia = createPinia();
export default pinia;
```

```javascript
//main.js
import pinia from "./stores";
```

```javascript
//counter.js
//å®šä¹‰å…³äºcounterçš„store
import {defineStore} from "pinia"
â€‹
//defineStoreè¿”å›çš„æ˜¯ä¸€ä¸ªå‡½æ•°
const useCounterStore = defineStore("counter",{
 Â state:() => ({
 Â  Â count:99
  })
})
â€‹
export default useCounterStore
```

åˆ›å»º Home ç»„ä»¶

```vue
<template>
  <div class="home">
    <h2>Home View</h2>
    <h2>count:{{ CounterStore.count }}</h2>
    <h2>count:{{ count }}</h2>
    <button @click="increment">ç‚¹å‡»æ›´æ–°count</button> Â 
  </div>
</template>
<script setup>
import useCounterStore from "@/stores/counter";
import { storeToRefs } from "pinia"; //piniaæä¾›çš„å“åº”å¼
const CounterStore = useCounterStore(); //ä¹Ÿå¯ä»¥è¿›è¡Œç»“æ„
const { count } = storeToRefs(CounterStore);
const increment = () => {
  CounterStore.count++;
};
</script>
```

åœ¨ App.vue ä¸­å¯¼å…¥ Home ç»„ä»¶

```vue
<template>
  <Home />
</template>
<script setup>
import Home from "./views/Home.vue";
</script>
```

## 3.State çš„ä½¿ç”¨ä¸è®¤è¯†

### 3.1.åˆ›å»º user.js æ–‡ä»¶

```javascript
import {defineStore} from "pinia"
const useUserStores = defineStore("user",{
 Â state:()=> ({
 Â  Â name:"tim",
 Â  Â age:21,
 Â  Â level:20
  })
})
â€‹
export default useUserStores
```

```vue
<template>
  <div class="home">
    <h2>Home View</h2>
    <h2>name:{{ name }}</h2>
    <h2>age:{{ age }}</h2>
    <h2>level:{{ level }}</h2>
  </div>
</template>
<script setup>
import useUserStore from "pinia";
const useUserStore = useUserStores();
const { name, age, level } = storeToRefs(useUserStore);
</script>
```

### 3.2.æ“ä½œ State

- 1.è®¤è¯†ä¸åŒæ–¹å¼çš„æ“ä½œ State æ•°æ®
- 2.ä½¿ç”¨$reset()è¿›è¡Œæ•°æ®é‡ç½®(æ•°æ®ä¸€å¼€å§‹ pinia ä¼šè¿›è¡Œç¼“å­˜)

```vue
<template>
  <div class="home">
    <h2>Home View</h2>
    <h2>name:{{ name }}</h2>
    <h2>age:{{ age }}</h2>
    <h2>level:{{ level }}</h2>
    <button @click="changeState">ä¿®æ”¹state</button> Â  Â 
    <button @click="resetState">é‡ç½®state</button>
  </div>
</template>
<script setup>
import useUserStore from "pinia";
const useUserStore = useUserStores();
const { name, age, level } = storeToRefs(useUserStore); //ä¿®æ”¹State
const changeState = () => {
  //1. ä¸€æ¬¡åªä¿®æ”¹ä¸€ä¸ªçŠ¶æ€
  //useUserStore.name = "kobe",
  //useUserStore.age = "18",
  //useUserStore.level = 100
  //2. ä¸€æ¬¡ä¿®æ”¹æ‰€æœ‰çŠ¶æ€
  //useUserStore.$patch({
  //name:"james",
  //age:35
  //})
  //3. æ›¿æ¢stateä¸ºæ–°çš„å¯¹è±¡ (å¾ˆå°‘ä½¿ç”¨)
  useUserstore.$state = {
    name: "å§šæ˜",
    level: 80,
  };
}; //é‡ç½®State
const resetState = () => {
  useUserStore.$reset(); //å¯ä»¥é‡ç½®åˆ°åˆå§‹åŒ–çŠ¶æ€,å› ä¸ºä¸€å¼€å§‹å°±ç¼“å­˜äº†åˆå§‹åŒ–çŠ¶æ€
};
</script>
```

## 4.è®¤è¯† Getters

- å®ƒä»¬å¯ä»¥ç”¨ defineStore() ä¸­çš„ getters å±æ€§å®šä¹‰;
- getters ä¸­å¯ä»¥å®šä¹‰æ¥å—ä¸€ä¸ª state ä½œä¸ºå‚æ•°çš„å‡½æ•°;
- getter ç›¸å½“äº Store çš„è®¡ç®—å±æ€§

### 4.1 å®šä¹‰ Getters

- 1.ä½¿ç”¨ getters:{å®šä¹‰å‡½æ•°(state)} å‡½æ•°é‡Œé¢æä¾›äº† state æ•°æ®å¯ä»¥ç›´æ¥è·å– || getters é‡Œé¢å¯ä»¥ç›´æ¥æ˜¯ç”¨ this è·å–
- 2.getters å¼•å…¥å¦å¤–ä¸€ä¸ª getters çš„ä½¿ç”¨
- 3.getters æ”¯æŒè¿”å›å‡½æ•°
- 4.getters ä¸­ä½¿ç”¨åˆ«çš„ store ä¸­æ•°æ®

```javascript
//counter.js
//å®šä¹‰å…³äºcounterçš„store
import {defineStore} from "pinia"
import {useUserStores} from "./user"
//defineStoreè¿”å›çš„æ˜¯ä¸€ä¸ªå‡½æ•°
const useCounterStore = defineStore("counter",{
 Â state:() => ({
 Â  Â count:99,
 Â  Â person: [
 Â  Â   {id:1,name:"å‘¨å†¬é›¨"},
 Â  Â   {id:2,name:"å‘¨æ°ä¼¦"},
 Â  Â   {id:3,name:"å‘¨ç¬”ç•…"}
 Â   ]
  }),
 Â getters: {
 Â  Â //1.åŸºæœ¬ä½¿ç”¨
 Â  Â doubleCount(state) {
 Â  Â  Â return state.count * 2
 Â   }
 Â  Â doubleCountChange() {
      return this.doubleCount + 'ğŸ«'
    }
 Â   getPersonId(state) {
      return function(id) {
 Â  Â  Â  Â return state.person.filter(item => item.id === id)
 Â  Â   }
    }
    showMessage() {
 Â  Â  Â //1.è·å–userä¿¡æ¯
 Â  Â  Â const useUserStore = useUserStores()
 Â  Â  Â //2.è·å–æœ¬æ–‡ä»¶ä¿¡æ¯
 Â  Â  Â 
 Â  Â  Â //3.æ‹¼æ¥ä¿¡æ¯
 Â  Â  Â return `name:${useUserStore.name}-count:${state.count}`
 Â   }
  }
})
â€‹
export default useCounterStore
```

```vue
<template>
  <div class="home">
    <h2>Home View</h2>
    <h2>doubleCount: {{ CounterStore.doubleCount }}</h2>
    <h2>doubleCountChange: {{ CounterStore.doubleCountChange }}</h2>
    <h2>getPersonId: {{ CounterStore.getPersonId(2) }}</h2>
    <h2>showMessage: {{ CounterStore.showMessage }}</h2>
  </div>
</template>
<script setup>
import useCounterStore from "@/stores/counter";
import { storeToRefs } from "pinia"; //piniaæä¾›çš„å“åº”å¼
const CounterStore = useCounterStore();
</script>
```

## 5.è®¤è¯†å’Œå®šä¹‰ Actions

> **Actions ç›¸å½“äºç»„ä»¶ä¸­çš„ methods**

- å¯ä»¥ä½¿ç”¨ defineStore()ä¸­çš„ actions å±æ€§å®šä¹‰,å¹¶ä¸”å®ƒä»¬éå¸¸é€‚åˆå®šä¹‰ä¸šåŠ¡é€»è¾‘
- Actions å’Œ Getters ä¸€æ ·å¯ä»¥ä½¿ç”¨ this è®¿é—®æ•´ä¸ª store å®ä¾‹çš„æ‰€æœ‰æ“ä½œ

### 5.1 å®šä¹‰ actions

```javascript
//counter.js
//å®šä¹‰å…³äºcounterçš„store
import {defineStore} from "pinia"
import {useUserStores} from "./user"
//defineStoreè¿”å›çš„æ˜¯ä¸€ä¸ªå‡½æ•°
const useCounterStore = defineStore("counter",{
 Â state:() => ({
 Â  Â count:99,
 Â  Â person: [
 Â  Â   {id:1,name:"å‘¨å†¬é›¨"},
 Â  Â   {id:2,name:"å‘¨æ°ä¼¦"},
 Â  Â   {id:3,name:"å‘¨ç¬”ç•…"}
 Â   ]
  }),
 Â getters: {
 Â  Â //1.åŸºæœ¬ä½¿ç”¨
 Â  Â doubleCount(state) {
 Â  Â  Â return state.count * 2
 Â   }
 Â  Â doubleCountChange() {
      return this.doubleCount + 'ğŸ«'
    }
 Â   getPersonId(state) {
      return function(id) {
 Â  Â  Â  Â return state.person.filter(item => item.id === id)
 Â  Â   }
    }
    showMessage() {
 Â  Â  Â //1.è·å–userä¿¡æ¯
 Â  Â  Â const useUserStore = useUserStores()
 Â  Â  Â //2.è·å–æœ¬æ–‡ä»¶ä¿¡æ¯
 Â  Â  Â //3.æ‹¼æ¥ä¿¡æ¯
 Â  Â  Â return `name:${useUserStore.name}-count:${state.count}`
 Â   }
  },
 Â actions: {
 Â  Â increment(state) {
 Â  Â  Â console.log(state) //actionsæ²¡æœ‰state,å‚æ•°æ˜¯ä¼ é€’çš„å‚æ•°
 Â  Â  Â this.count++
 Â   }
  }
})

export default useCounterStore
```

```vue
<template>
  <div class="home">
    <h2>Home View</h2>
    <h2>doubleCount: {{ count }}</h2>
    <button @click="changeState">ä¿®æ”¹state</button> Â 
  </div>
</template>
<script setup>
import useCounterStore from "@/stores/counter";
import { storeToRefs } from "pinia"; //piniaæä¾›çš„å“åº”å¼
const CounterStore = useCounterStore();
const { count } = storeToRefs(CounterStore);
function changeState() {
  CounterStore.increment();
}
</script>
```

### 5.2.actions å¼‚æ­¥æ“ä½œ

- 1.å®šä¹‰ home.js,å¹¶ä¸”æå‰ç»™ state ç»™æ•°æ®ç±»å‹(éšä¾¿æä¸€å˜´,pinia å’Œ ts ä¼šäº†ä¹‹å,ç®€ç›´æ— æ•Œ)
- 2.å®šä¹‰ actions è·å–æ•°æ®å¹¶ä¸”èµ‹å€¼ç»™ state
- 3.åœ¨ home.vue ä¸­ä½¿ç”¨

```javascript
//home.js
import {defineStore} from "pinia"
const useHomeStores = defineStore("home",{
 Â state: ()=> ({
 Â  Â banners:[],
 Â  Â recommends:[]
  })
 Â actions: {
    async fetchHome() {
      const response = await fetch("http://localhost:8000/home")
 Â  Â  Â const data = await response.json()
 Â  Â  Â this.banners = data.data.banner
    }
  }
})

export default useHomeStores
```

```vue
<template>
  <div class="home">
    <h2>Home View</h2>
    <ul>
      <li v-for="item in banners">
        <img :src="item" />
      </li>
    </ul>
  </div>
</template>
<script setup>
import useHomeStores from "@/stores/home";
import { storeToRefs } from "pinia";
const useHomeStore = useHomeStores();
const { banners } = storeToRefs(useHomeStore);
useHomeStore.fetchHomeMultidata().then((res) => {
  console.log("è¯·æ±‚å®Œæˆ", res);
});
</script>
```
