---
title: "ã€Reacté”™è¯¯å¤„ç†ã€‘è¶…å…¨æŒ‡å—æ¥äº†"
date: 2023-04-24T18:02:29+08:00
---

## ä¸€ã€ä¸ºä½•æŠ¥é”™ä¼šå¯¼è‡´æ¸²æŸ“å¼‚å¸¸ï¼Ÿ

åœ¨ React ä¸­ï¼Œæœªæ•è·é”™è¯¯ä¼šå¯¼è‡´**DOM**è¢«å¸è½½, æµè§ˆå™¨æ— æ³•æ¸²æŸ“ã€‚ ä¸ºä½• React é€‰æ‹©å®Œå…¨ç§»é™¤é”™è¯¯çš„**DOM**å‘¢ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹çœ‹å®˜ç½‘ä¸­çš„è¿™æ®µè¯ï¼š

> æœªæ•è·é”™è¯¯ï¼ˆUncaught Errorsï¼‰çš„æ–°è¡Œä¸º
>
> è¿™ä¸€æ”¹å˜å…·æœ‰é‡è¦æ„ä¹‰ï¼Œ**è‡ª React 16 èµ·ï¼Œä»»ä½•æœªè¢«é”™è¯¯è¾¹ç•Œæ•è·çš„é”™è¯¯å°†ä¼šå¯¼è‡´æ•´ä¸ª React ç»„ä»¶æ ‘è¢«å¸è½½ã€‚**
>
> æˆ‘ä»¬å¯¹è¿™ä¸€å†³å®šæœ‰è¿‡ä¸€äº›äº‰è®ºï¼Œä½†æ ¹æ®æˆ‘ä»¬çš„ç»éªŒï¼ŒæŠŠä¸€ä¸ªé”™è¯¯çš„ UI ç•™åœ¨é‚£æ¯”å®Œå…¨ç§»é™¤å®ƒè¦æ›´ç³Ÿç³•ã€‚ä¾‹å¦‚ï¼Œåœ¨ç±»ä¼¼ Messenger çš„äº§å“ä¸­ï¼ŒæŠŠä¸€ä¸ªå¼‚å¸¸çš„ UI å±•ç¤ºç»™ç”¨æˆ·å¯èƒ½ä¼šå¯¼è‡´ç”¨æˆ·å°†ä¿¡æ¯é”™å‘ç»™åˆ«äººã€‚åŒæ ·ï¼Œå¯¹äºæ”¯ä»˜ç±»åº”ç”¨è€Œè¨€ï¼Œæ˜¾ç¤ºé”™è¯¯çš„é‡‘é¢ä¹Ÿæ¯”ä¸å‘ˆç°ä»»ä½•å†…å®¹æ›´ç³Ÿç³•ã€‚

ä»æˆ‘çš„å¼€å‘ç»éªŒçœ‹æ¥ï¼Œå‡ºç° bug çš„åŸå› ä¸»è¦æœ‰ä»¥ä¸‹ä¸¤ç‚¹ï¼š

**â‘  åç«¯è¿”å›æ•°æ®å¼‚å¸¸ï¼Œå‰ç«¯ä»£ç æœªå…¼å®¹å®Œå…¨;**

**â‘¡ å‰ç«¯ç¨‹åºé€»è¾‘é”™è¯¯ï¼›**

å¦‚æœé¡¹ç›®ä¸Šçº¿åï¼Œé¡µé¢æ— æ³•æ­£å¸¸æ‰“å¼€ï¼Œæ— æ³•æ‰§è¡Œå…¶ä»–æ“ä½œç”šè‡³ä¸€ç‰‡ç©ºç™½ï¼Œç”¨æˆ·çš„ä½“éªŒæ„Ÿæ˜¯éå¸¸ä¸å¥½çš„ã€‚

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9a31ba62e788403bac846cb6df17eba3~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp?)

å› æ­¤ï¼Œæˆ‘ä»¬æœ‰å¿…è¦é‡‡å–ä¸€äº›æªæ–½æ¥é¢„é˜²å’Œå¤„ç†å¼‚å¸¸/é”™è¯¯ï¼Œé¿å…æ•´ä¸ªé¡µé¢å´©æºƒã€‚

## äºŒã€è§£å†³æ–¹æ¡ˆï¼šé¢„é˜²å’Œè¡¥æ•‘

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/63fae554560e4553b775a3c8d21779f2~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp?)

### (1) â€œé˜² bug äºæœªç„¶â€: å¯¹åç«¯æ•°æ®è¿›è¡Œé¢„å¤„ç†

æ­£å¸¸æƒ…å†µä¸‹ï¼Œå‰ç«¯å°ä¼™ä¼´ä¸åç«¯æå‰æ²Ÿé€šå¥½çŠ¶æ€ç å’Œæ•°æ®ç»“æ„ï¼Œæ ¹æ®çŠ¶æ€ç åšå‡ºä¸åŒå“åº”å³å¯ã€‚ä½†æ˜¯ï¼Œå½“åç«¯æ•°æ®å¼‚å¸¸ï¼ˆå¦‚è¿”å›**undefined**, **null**ï¼‰æ—¶ï¼Œå‰ç«¯ç›´æ¥è°ƒç”¨æ•°ç»„çš„æŸäº›æ–¹æ³•æˆ–è€…å¯¹è±¡çš„æŸäº›å±æ€§æ—¶å°±ä¼šæŠ¥é”™ã€‚

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/78149717f6754984941c89529c8b7b01~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp?)

- å‰ç«¯å°ä¼™ä¼´è°¨è®°, "ä¸è¦å®Œå…¨ç›¸ä¿¡åç«¯çš„æ•°æ®"ã€‚

åœ¨ä½¿ç”¨åç«¯æ•°æ®å‰ï¼Œæœ€å¥½å…ˆèµ‹é»˜è®¤å€¼ã€‚

ä¸¾ä¸ª ğŸŒ°ï¼š

```js
// â‘  è§£æ„æ—¶èµ‹é»˜è®¤å€¼ ï¼ˆæ³¨æ„ï¼šarrä¸ºnullæ—¶ï¼Œæ— æ³•èµ‹å€¼æˆåŠŸï¼‰
// â‘¡ ä½¿ç”¨é€»è¾‘æˆ–
const {arr = []} = data || {};

// â‘¢ ä½¿ç”¨å¯é€‰è¿ç®—ç¬¦
const names = _arr?.map((item = {})=>(item?.name))).filter(Boolean);
// ...
```

åœ¨å¤æ‚çš„åœºæ™¯ä¸‹ï¼Œä½ ç”šè‡³å¯ä»¥åšæ›´å¤šâ€”â€”ä¾‹å¦‚ï¼Œå…ˆå°†åå°æ•°æ®è¿›è¡Œé¢„å¤„ç†(ä¸ä¸šåŠ¡é€»è¾‘æ— å…³çš„æ•°æ®å¤„ç†)ï¼Œè½¬ä¸ºè‡ªèº«éœ€è¦çš„ç»“æ„å’Œç±»å‹ï¼Œè®©ä¸šåŠ¡ç»„ä»¶/é€»è¾‘æ›´åŠ çº¯ç²¹åœ°å¤„ç†ä¸šåŠ¡çš„åŒæ—¶ï¼Œå‡å°‘ bug å‡ºç°çš„æ¦‚ç‡ã€‚

ï¼ˆå½“ç„¶ï¼Œæœ‰å¾ˆå¤š bug æ˜¯å‰ç«¯ä»£ç è‡ªèº«çš„é—®é¢˜ï¼Œåœ¨æ­¤ä¸èµ˜è¿°é¢„é˜²æªæ–½äº†ï¼Œå¤§å®¶å¯ä»¥è‡ªè¡Œæ€è€ƒ ğŸ¤”ã€‚ï¼‰

ç„¶è€Œäººæ— å®Œäººï¼Œbug æ€»æ˜¯é˜²ä¸èƒœé˜²ï¼Œé‚£ä¹ˆå¦‚ä½•å‡å° bug çš„å½±å“å‘¢ï¼Ÿ

### (2) â€œäº¡ç¾Šè¡¥ç‰¢â€ä¹‹ä½¿ç”¨å¸¸è§„æ‰‹æ®µæ•è·å¼‚å¸¸ï¼›

å¯¹äº javascript è€Œè¨€ï¼Œæ‰§è¡Œçš„äº‹ä»¶ä¸»è¦æœ‰ä»¥ä¸‹äº”ç§ï¼š**åŒæ­¥æ–¹æ³•ã€å¼‚æ­¥æ–¹æ³•ã€èµ„æºåŠ è½½ã€Promiseã€async...await**ï¼Œäº‹ä»¶æ‰§è¡Œå¤±è´¥æ„å‘³ç€ç¨‹åºå‡ºç° bugã€‚

å¹¸è¿çš„æ˜¯ï¼Œè¿™äº›å¼‚å¸¸å‡å¯é€šè¿‡æ¡†æ¶ï¼ˆreact/vue/angular ç­‰ï¼‰ä¹‹å¤–çš„å¸¸è§„æ‰‹æ®µæ•è·åˆ°ã€‚

**æ–¹æ³•æ±‡æ€»**

| å¼‚å¸¸ç±»å‹                               | åŒæ­¥æ–¹æ³• | å¼‚æ­¥æ–¹æ³• | èµ„æºåŠ è½½ | Promise | async...await |
| -------------------------------------- | -------- | -------- | -------- | ------- | ------------- |
| try...catch                            | âˆš        |          |          |         | âˆš             |
| window.onerror                         | âˆš        | âˆš        |          |         |               |
| addEventListener('error')              | âˆš        | âˆš        | âˆš        |         |               |
| addEventListener(â€œunhandledrejectionâ€) |          |          |          | âˆš       | âˆš             |

1. [try...catch](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Statements/try...catch)

- `try...catch` è¯­å¥æ ‡è®°è¦å°è¯•çš„è¯­å¥å—ï¼Œå¹¶æŒ‡å®šä¸€ä¸ªå‡ºç°å¼‚å¸¸æ—¶æŠ›å‡ºçš„å“åº”ã€‚

ä¸¾äº› ğŸŒ°ï¼š

â‘  å¤„ç†åŒæ­¥é”™è¯¯ï¼›

- **MDN Web Docs** ä¸­çš„ä¾‹å­ï¼š

```js
try {
  nonExistentFunction();
} catch (error) {
  console.error(error);
  // Expected output: ReferenceError: nonExistentFunction is not defined
  // (Note: the exact output may be browser-dependent)
}
```

â‘¡ å¤„ç†å¼‚æ­¥é”™è¯¯

é€šå¸¸ï¼Œè‹¥ **try** ä¸­çš„å¼‚æ­¥æ¨¡å—äº§ç”Ÿäº†é”™è¯¯ï¼Œ**catch** æ˜¯æ•è·ä¸åˆ°çš„ã€‚ä½†æ˜¯æˆ‘ä»¬å¯ä»¥æŠŠ **try-catch** æ”¾åˆ°å¼‚æ­¥ä»£ç ä¸­ã€‚

- å°† **try-catch** æ”¾åˆ° **setTimeout** å†…éƒ¨

```javascript
setTimeout(() => {
  try {
    throw new Error("error in setTimeout");
  } catch (err) {
    console.error("catch error", err);
  }
}, 200);
```

- å°† **try-catch** æ”¾åˆ° **then**å†…éƒ¨

```javascript
Promise.resolve().then(() => {
  try {
    throw new Error("error in Promise.then");
  } catch (err) {
    console.error("catch error", err);
  }
});

// æ­£å¸¸æƒ…å†µä¸‹ï¼Œä½¿ç”¨Promseè‡ªå¸¦çš„catchæ•è·å¼‚å¸¸å³å¯
Promise.resolve()
  .then(() => {
    throw new Error("error in Promise.then");
  })
  .catch((err) => {
    console.error("Promise.catch error", err);
  });
```

â‘¢ å¤„ç† **async-await** çš„å¼‚å¸¸

- å°† **try** æ”¾åœ¨ **async** ä¹‹å

```javascript
const request = async () => {
  try {
    const { code, data } = await somethingThatReturnsAPromise();
  } catch (err) {
    console.error("request error", err);
  }
};
```

2. window.onerror

å½“ JavaScript è¿è¡Œæ—¶é”™è¯¯ï¼ˆåŒ…æ‹¬è¯­æ³•é”™è¯¯ï¼‰å‘ç”Ÿæ—¶ï¼Œä¼šæ‰§è¡Œ window.onerror æ–¹æ³•ã€‚

```js
function onError(msg, url, lineNo, columnNo, error) {
  /*
   * messageï¼šé”™è¯¯ä¿¡æ¯ï¼ˆå­—ç¬¦ä¸²ï¼‰ã€‚å¯ç”¨äºHTML onerror=""å¤„ç†ç¨‹åºä¸­çš„eventã€‚
   * sourceï¼šå‘ç”Ÿé”™è¯¯çš„è„šæœ¬URLï¼ˆå­—ç¬¦ä¸²ï¼‰
   * linenoï¼šå‘ç”Ÿé”™è¯¯çš„è¡Œå·ï¼ˆæ•°å­—ï¼‰
   * colnoï¼šå‘ç”Ÿé”™è¯¯çš„åˆ—å·ï¼ˆæ•°å­—ï¼‰
   * errorï¼šErrorå¯¹è±¡
   */

  // æ²¡æœ‰è¿”å›å€¼æˆ–è€…è¿”å›å€¼ä¸ºfalseçš„æ—¶å€™ï¼Œå¼‚å¸¸ä¿¡æ¯ä¼šé€šè¿‡ console.error çš„æ–¹å¼åœ¨æ§åˆ¶å°æ‰“å°
  return false;
}
window.onerror = onError;
```

3. addEventListener('error')

å½“èµ„æºåŠ è½½å¤±è´¥æˆ–æ— æ³•ä½¿ç”¨æ—¶ï¼Œä¼šåœ¨[`Window`](https://developer.mozilla.org/zh-CN/docs/Web/API/Window)å¯¹è±¡è§¦å‘`error`äº‹ä»¶ã€‚ä¾‹å¦‚ï¼šscript æ‰§è¡Œæ—¶æŠ¥é”™ã€‚

```js
window.addEventListener(
  "error",
  (event) => {
    console.log("æ•è·åˆ°å¼‚å¸¸", event);
    return false;
  },
  true
); // æ•è·é˜¶æ®µ
```

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/71acff6be7954e43a742a1ca337721ce~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp?)

4. addEventListener('unhandledrejection')

å½“ Â [`Promise`](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise)Â  è¢« reject ä¸”æ²¡æœ‰ reject å¤„ç†å™¨çš„æ—¶å€™ï¼Œä¼šè§¦å‘`unhandledrejection`äº‹ä»¶ã€‚

```javascript
// æ•è·æœªå¤„ç†çš„ promise å¼‚å¸¸
window.addEventListener("unhandledrejection", (event) => {
  console.warn(`UNHANDLED PROMISE REJECTION: ${event.reason}`);
});
```

## å°ç»“

![åšç¬”è®°.gif](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0724ba71da174778b37d4bb99a7599ba~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp?)

â‘  `try...catch` æœ€ä¸ºçµæ´»ï¼Œé€šè¿‡ä½¿ç”¨ä¸€äº›å°æŠ€å·§ï¼Œå¯ä»¥æ•è·ç»å¤§éƒ¨åˆ†å¼‚å¸¸ï¼Œæ•è·åˆ°é”™è¯¯åå¯ä»¥åœ¨ catch ä¸­è¿›è¡Œæ›´å¤šå¤„ç†ï¼›

â‘¡ `addEventListener('error')`Â  äº‹ä»¶ç›‘å¬ js è¿è¡Œæ—¶é”™è¯¯äº‹ä»¶ï¼Œä¼šæ¯” window.onerror å…ˆè§¦å‘ï¼Œä¸ onerror çš„åŠŸèƒ½å¤§ä½“ç±»ä¼¼ï¼Œä½†å¯ä»¥å…¨å±€æ•è·èµ„æºåŠ è½½å¼‚å¸¸çš„é”™è¯¯ï¼›

â‘¢ `addEventListener('error')` ç»“åˆ `addEventListener('unhandledrejection')`ï¼Œå‡ ä¹å¯ä»¥æ•è·ç¨‹åºä¸­çš„æ‰€æœ‰é”™è¯¯ï¼Œä½†ä¸»è¦åªæ˜¯æä¾›äº†é”™è¯¯å †æ ˆä¿¡æ¯ï¼›

â‘£ å½“ä½¿ç”¨ä»¥ä¸Šå››ç§å¸¸è§„æ‰‹æ®µæ•è·åˆ°é”™è¯¯åï¼Œæˆ‘ä»¬å¯ä»¥åšè®¸å¤šäº‹æƒ…ã€‚ä¾‹å¦‚ï¼Œåœ¨å¼€å‘ç¯å¢ƒä¸­ï¼Œå¯å°†é”™è¯¯ä¿¡æ¯æ‰“å°åœ¨æµè§ˆå™¨æ§åˆ¶å°ä¸Šã€å¯æŠ›å‡ºå¼‚å¸¸é€šçŸ¥ä¸‹æ¸¸, æ–¹ä¾¿å¼€å‘è°ƒè¯•ï¼›åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå¯ä¸ŠæŠ¥é”™è¯¯æ—¥å¿—è¿›è¡Œé”™è¯¯ç›‘æ§ï¼Œè€Œåœ¨ä¿®å¤ bug çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åšæ›´å¤šâ€”â€”ç»“åˆé”™è¯¯è¾¹ç•Œï¼ˆError Boundaryï¼‰ä¸ºç”¨æˆ·æ¸²æŸ“ä¸€äº›æœ‰ç”¨çš„å†…å®¹ã€‚

### (3) â€œäº¡ç¾Šè¡¥ç‰¢â€ä¹‹ä½¿ç”¨ Error Boundary

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/dfc363929afd424f8a6a2f6030be0c10~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp?)

ä¸Šæ–‡æåˆ°ï¼Œ_try...catch_ ç‰¹åˆ«å¥½ç”¨ï¼Œä½†æ˜¯å®ƒæ— æ³•ç›´æ¥æ•è·åˆ° react ç»„ä»¶ä¸­çš„æ‰€æœ‰å¯èƒ½å‘ç”Ÿçš„é”™è¯¯ï¼Œå¦‚å­ç»„ä»¶ä¸­çš„é”™è¯¯ã€‚

æ­¤æ—¶ï¼Œ_Error Boundary_ å°±å¿…é¡»å¾—é—ªäº®ç™»åœºäº†~

1. Error Boundary æ¦‚å¿µ

> é”™è¯¯è¾¹ç•Œæ˜¯ä¸€ç§ React ç»„ä»¶ï¼Œè¿™ç§ç»„ä»¶**å¯ä»¥æ•è·å‘ç”Ÿåœ¨å…¶å­ç»„ä»¶æ ‘ä»»ä½•ä½ç½®çš„ JavaScript é”™è¯¯ï¼Œå¹¶æ‰“å°è¿™äº›é”™è¯¯ï¼ŒåŒæ—¶å±•ç¤ºé™çº§ UI**ï¼Œè€Œå¹¶ä¸ä¼šæ¸²æŸ“é‚£äº›å‘ç”Ÿå´©æºƒçš„å­ç»„ä»¶æ ‘ã€‚

é”™è¯¯è¾¹ç•Œæœ€åŸºæœ¬çš„å®ç°ï¼š

```jsx
class ErrorBoundary extends React.Component {
  constructor(props) {
    super(props);
    this.state = { hasError: false };
  }
  static getDerivedStateFromError(error) {    // æ›´æ–° state ä½¿ä¸‹ä¸€æ¬¡æ¸²æŸ“èƒ½å¤Ÿæ˜¾ç¤ºé™çº§åçš„ UI    return { hasError: true };  }
  componentDidCatch(error, errorInfo) {    // ä½ åŒæ ·å¯ä»¥å°†é”™è¯¯æ—¥å¿—ä¸ŠæŠ¥ç»™æœåŠ¡å™¨    logErrorToMyService(error, errorInfo);  }
  render() {
    if (this.state.hasError) {      // ä½ å¯ä»¥è‡ªå®šä¹‰é™çº§åçš„ UI å¹¶æ¸²æŸ“      return <h1>Something went wrong.</h1>;    }
    return this.props.children;
  }
}
```

ä½¿ç”¨

```jsx
<ErrorBoundary>
  <MyWidget />
</ErrorBoundary>
```

tips, æ—¥å¸¸å¼€å‘ä¸­ï¼Œæˆ‘ä»¬éœ€è¦ä¸ºä¸åŒç²’åº¦çš„ç»„ä»¶è¿ç”¨é”™è¯¯è¾¹ç•Œç»„ä»¶ï¼Œå°½é‡å‡å° bug çš„å½±å“èŒƒå›´ã€‚

2. Error Boundary å¯ç”¨åœºæ™¯å’Œä¸å¯ç”¨åœºæ™¯

â‘  é”™è¯¯è¾¹ç•Œèµ·ä½œç”¨çš„åœºæ™¯ï¼š

- å‘ç”Ÿåœ¨æ•´ä¸ªå­ç»„ä»¶æ ‘çš„æ¸²æŸ“æœŸé—´ã€ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ä»¥åŠæ„é€ å‡½æ•°ä¸­çš„é”™è¯¯

â‘¡ é”™è¯¯è¾¹ç•Œä¸èµ·ä½œç”¨çš„åœºæ™¯:

- ç»„ä»¶å¤–çš„æŠ¥é”™ã€å¼‚æ­¥ä»£ç çš„æŠ¥é”™ã€äº‹ä»¶å‡½æ•°ä¸­çš„æŠ¥é”™ã€é”™è¯¯è¾¹ç•Œè‡ªèº«æŠ›å‡ºçš„é”™è¯¯ã€é”™è¯¯è¾¹ç•Œçš„çˆ¶ç»„ä»¶æŠ¥é”™ã€ å‡½æ•°ç»„ä»¶è¢«å¸è½½ï¼Œè§¦å‘ useEffect çš„é”€æ¯ã€‚

3. æ€ä¹ˆè®© errorBoundary å¤„ç†åœ¨ç”Ÿå‘½å‘¨æœŸä¹‹å¤–çš„é”™è¯¯ï¼Ÿ

æœºæ™ºçš„å°ä¼™ä¼´ä¼šå‘ç°ï¼Œ**é”™è¯¯è¾¹ç•Œ**ä¸èƒ½å¤„ç†çš„è®¸å¤šé”™è¯¯ï¼Œæ¯”å¦‚ promiseã€å¼‚æ­¥ä»£ç ã€å„ç§å›è°ƒå’Œäº‹ä»¶å¤„ç†ç¨‹åºä¸­çš„é”™è¯¯ï¼Œå¯ä»¥ä½¿ç”¨å¸¸è§„ _try...catch_ æ¥å¤„ç†ã€‚

å› æ­¤ï¼Œæˆ‘ä»¬å…ˆç”¨ _try...catch_ æ•è·è¿™äº›é”™è¯¯ï¼Œç„¶ååœ¨ catch è¯­å¥å†…è§¦å‘æ­£å¸¸çš„ React é‡æ–°æ¸²æŸ“ï¼Œç„¶å **å°†è¿™äº›é”™è¯¯é‡æ–°æŠ›å‡ºåˆ°é‡æ–°æ¸²æŸ“ç”Ÿå‘½å‘¨æœŸä¸­**ã€‚

- â‘  å®šä¹‰å¼‚æ­¥é”™è¯¯æŠ›å‡ºå·¥å…·ï¼š

```tsx
// å®šä¹‰
import { useState } from "react";

const useThrowAsyncError = () => {
  const [, setState] = useState();

  return (e: any) => {
    setState(() => {
      throw e;
    });
  };
};

export default useThrowAsyncError;

// ä½¿ç”¨ç¤ºä¾‹
const Component = () => {
  const throwAsyncError = useThrowAsyncError();

  useEffect(() => {
    fetch("/bla")
      .then()
      .catch((e) => {
        // throw async error here!
        throwAsyncError(e);
      });
  });
};
```

- â‘¡ ä¸ºå›è°ƒå‡½æ•°åšé¢å¤–å¤„ç†ï¼š

```tsx
// å®šä¹‰
import { useState } from "react";

const useCallbackWithErrorHandler = (
  callback: (...args: any[]) => any,
  useErrorBoundary: boolean = false
) => {
  const [, setState] = useState();

  return async (...args: any[]) => {
    try {
      await callback(...args);
    } catch (e) {
      useErrorBoundary &&
        setState(() => {
          throw e;
        });
    }
  };
};

export default useCallbackWithErrorHandler;

// ä½¿ç”¨ç¤ºä¾‹
const Component = () => {
  const onClick = () => {
    // do something dangerous here
  };
  const onClickWithErrorHandler = useCallbackWithErrorHandler(onClick);

  return <button onClick={onClickWithErrorHandler}>click me!</button>;
};
```

## ä¸‰ã€æ€»ç»“

å¸Œæœ›çœ‹åˆ°è¿™é‡Œçš„å°ä¼™ä¼´ï¼Œå¯ä»¥ä»å®¹è€Œä¼˜é›…åœ°å¤„ç†ç¨‹åºä¸­å‡ºç°çš„ bugã€‚

æœ¬æ–‡å°±**é”™è¯¯å¤„ç†**åšäº†è¯¦ç»†çš„è§£æï¼Œä¸»è¦å†…å®¹å¦‚ä¸‹ï¼š

â‘  **å¿…è¦æ€§**ï¼šå› ä¸ºæœªè¢«é”™è¯¯è¾¹ç•Œæ•è·çš„å¼‚å¸¸ä¼šå¯¼è‡´æ•´ä¸ª react ç»„ä»¶æ ‘è¢«å¸è½½ï¼Œå¾®ä¸è¶³é“çš„é”™è¯¯éƒ½æœ‰å¯èƒ½å¯¼è‡´æ•´ä¸ªé¡µé¢å—åˆ°ç ´åï¼Œå¹¶ä¸ºç”¨æˆ·æ¸²æŸ“å‡ºä¸€ä¸ªç™½å±ï¼Œæ‰€ä»¥é¢„é˜²å¹¶å¤„ç†å¼‚å¸¸æ˜¯å¿…è¦çš„ã€‚

â‘¡ **é¢„é˜²æªæ–½**ï¼šå°½é‡å‡å°‘ bug å‡ºç°çš„æ¦‚ç‡ï¼Œé™¤äº†å‡å°‘å‰ç«¯è‡ªèº«ä»£ç çš„é—®é¢˜ï¼Œæœ€å¥½å¯¹åç«¯æ•°æ®è¿›è¡Œé¢„å¤„ç†å†ä½¿ç”¨ï¼›

â‘¢ **äº‹åè¡¥æ•‘æ–¹æ¡ˆ 1**ï¼šä½¿ç”¨å¸¸è§„æ‰‹æ®µï¼ˆå¦‚*try...catchã€window.onerrorã€addEventListener('error')ã€addEventListener('unhandledrejection')*ï¼‰æ•è·å¼‚å¸¸å¹¶åšè¿›ä¸€æ­¥å¤„ç†ï¼Œå¦‚é”™è¯¯ä¸ŠæŠ¥ã€æ›´æ–°çŠ¶æ€æ¸²æŸ“é™çº§ UI ç­‰ï¼›

â‘£ **äº‹åè¡¥æ•‘æ–¹æ¡ˆ 2**ï¼šç»“åˆ*Error Boundary*ä¸ºç”¨æˆ·æ¸²æŸ“æœ‰ç”¨çš„ä¿¡æ¯ï¼Œé¿å…ç™½å±ï¼Œæå‡ç”¨æˆ·ä½“éªŒæ„Ÿã€‚

## å››ã€å‚è€ƒä¸æ„Ÿè°¢

![thanks.gif](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/48cef0f5ea924243865a65434c312f66~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp?)

1. [è§é¬¼ï¼Œä¸ºä½•æˆ‘çš„ ErrorBoundaryï¼ˆé”™è¯¯è¾¹ç•Œï¼‰ä¸èµ·ä½œç”¨](https://juejin.cn/post/7033210044426485797#heading-14)
2. è¯‘æ–‡ï¼š[React é”™è¯¯å¤„ç†ï¼šæœ€ä½³å®è·µ](https://juejin.cn/post/7207058392287576123#heading-9)

   åŸæ–‡ï¼š[How to handle errors in React: full guide](https://www.developerway.com/posts/how-to-handle-errors-in-react)

3. [å–‚ï¼Œä½ çš„é¡µé¢ç™½äº†ï¼é˜¿é‡Œè§£å†³ã€Œå‰ç«¯ç™½å±ã€çš„æ–¹æ¡ˆ](https://zhuanlan.zhihu.com/p/399348866)
4. [Reactï¼Œä¼˜é›…çš„æ•è·å¼‚å¸¸](https://juejin.cn/post/6974383324148006926)
5. [å‰ç«¯ä¸­ try-catch æ•è·ä¸åˆ°å“ªäº›å¼‚å¸¸å’Œé”™è¯¯](https://zhuanlan.zhihu.com/p/347756673)
6. [window.onerror å’Œ window.addEventListener('error')çš„åŒºåˆ«](https://cloud.tencent.com/developer/article/2203285)
7. [Throwing Error from hook not caught in error boundary Â· Issue #14981 Â· facebook/react](https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Ffacebook%2Freact%2Fissues%2F14981%23issuecomment-468460187)
